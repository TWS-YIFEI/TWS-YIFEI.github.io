<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'true', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-89376999-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-89376999-1');
</script>



  
  <title>PAM_验证模块开发实例 | YIFEI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="前言　　操作系统安全布置的作业，搞了一周多，虽然做完了。">
<meta name="keywords" content="linux,kernal,pam,auth">
<meta property="og:type" content="article">
<meta property="og:title" content="PAM_验证模块开发实例">
<meta property="og:url" content="http://yoursite.com/2018/10/21/20181021 PAM_验证模块开发实例/index.html">
<meta property="og:site_name" content="YIFEI">
<meta property="og:description" content="前言　　操作系统安全布置的作业，搞了一周多，虽然做完了。">
<meta property="og:locale" content="default">
<meta property="og:image" content="http://ohpezrhej.bkt.clouddn.com/image/2018/pam%E7%BB%93%E6%9E%84%E5%9B%BE.png?imageView2/2/w/500/h/700/q/99">
<meta property="og:image" content="http://ohpezrhej.bkt.clouddn.com/image/2018/pam%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F.png">
<meta property="og:image" content="http://ophezrhej.bkt/clouddn.com/image/2018/login1.png">
<meta property="og:image" content="http://ophezrhej.bkt/clouddn.com/image/2018/login2.png">
<meta property="og:updated_time" content="2018-10-26T02:42:58.472Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="PAM_验证模块开发实例">
<meta name="twitter:description" content="前言　　操作系统安全布置的作业，搞了一周多，虽然做完了。">
<meta name="twitter:image" content="http://ohpezrhej.bkt.clouddn.com/image/2018/pam%E7%BB%93%E6%9E%84%E5%9B%BE.png?imageView2/2/w/500/h/700/q/99">
  
    <link rel="alternate" href="/atom.xml" title="YIFEI" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

  
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">YIFEI</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">多一份不为什么的坚持！</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/links">Links</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>


</header>
      <div class="outer">
        <section id="main"><article id="post-20181021 PAM_验证模块开发实例" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/10/21/20181021 PAM_验证模块开发实例/" class="article-date">
  <time datetime="2018-10-20T16:00:01.000Z" itemprop="datePublished">2018-10-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Linux-Kernel/">Linux_Kernel</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      PAM_验证模块开发实例
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>　　操作系统安全布置的作业，搞了一周多，虽然做完了。<a id="more"></a><br>　　但还是对PAM不是很了解…</p>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>　　PAM（Pluggable Authentication Modules ）是由Sun公司提出的一种认证机制。最初集成在Solaris系统上。<br>　　在之前，由于各个应用程序都有各自的验证机制，所以导致系统验证机制混乱，而PAM很好地解决了这个问题，只用一套验证，让每个程序来调用即可。<br>　　由于是负责验证的，所以可以用来开发自己的PAM模块加固linux，但是也可以给linux留后门。</p>
<h2 id="PAM结构"><a href="#PAM结构" class="headerlink" title="PAM结构"></a>PAM结构</h2><p>　　看明白pam的结构可以帮助我们理解pam的运行机制:　　<br><img src="http://ohpezrhej.bkt.clouddn.com/image/2018/pam%E7%BB%93%E6%9E%84%E5%9B%BE.png?imageView2/2/w/500/h/700/q/99" alt="pam结构图"><br>　　pam可以分为以下几层：<br>　　① 应用层，这一层有login、telnet、su、sudo、ssh等程序，他们都会用到用户验证的功能。这些程序通过调用PAM的API来使用PAM库。下面的函数可以用来初始化PAM库。<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">pam_start</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *service_name, <span class="keyword">const</span> <span class="keyword">char</span> *user, <span class="keyword">const</span> struct pam_conv *pam_conversation, <span class="keyword">pam_handle_t</span> **pamh)</span></span></span><br></pre></td></tr></table></figure></p>
<p>　　const char <em>service_name:服务的名字，根据这个值确定使用哪个配置文件。<br>　　const char </em>user:需要验证的用户。<br>　　pam_conv *pam_conversation:一个结构体，构造如下：<br>  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">pam_conv</span>&#123;</span></span><br><span class="line">        <span class="keyword">int</span> (*conv)(<span class="keyword">int</span> num_msg, <span class="keyword">const</span> struct pam_message **msg,</span><br><span class="line">             struct pam_response **resp, <span class="keyword">void</span> *appdata_ptr);</span><br><span class="line">      <span class="keyword">void</span> *appdate_ptr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>　　pam_handle_t **pamh:一个结构体，存储pam会话的一些参数，构造如下：<br>  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">pam_handle</span> &#123;</span></span><br><span class="line">    <span class="keyword">char</span> *authtok;</span><br><span class="line">    <span class="keyword">unsigned</span> caller_is;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">pam_conv</span> *<span class="title">pam_conversation</span>;</span></span><br><span class="line">    <span class="keyword">char</span> *oldauthtok;</span><br><span class="line">    <span class="keyword">char</span> *prompt;                <span class="comment">/* for use by pam_get_user() */</span></span><br><span class="line">    <span class="keyword">char</span> *service_name;</span><br><span class="line">    <span class="keyword">char</span> *user;</span><br><span class="line">    <span class="keyword">char</span> *rhost;</span><br><span class="line">    <span class="keyword">char</span> *ruser;</span><br><span class="line">    <span class="keyword">char</span> *tty;</span><br><span class="line">    <span class="keyword">char</span> *xdisplay;</span><br><span class="line">    <span class="keyword">char</span> *authtok_type;          <span class="comment">/* PAM_AUTHTOK_TYPE */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">pam_data</span> *<span class="title">data</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">pam_environ</span> *<span class="title">env</span>;</span>      <span class="comment">/* structure to maintain environment list */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> _<span class="title">pam_fail_delay</span> <span class="title">fail_delay</span>;</span>   <span class="comment">/* helper function for easy delays */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">pam_xauth_data</span> <span class="title">xauth</span>;</span>        <span class="comment">/* auth info for X display */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">service</span> <span class="title">handlers</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> _<span class="title">pam_former_state</span> <span class="title">former</span>;</span>  <span class="comment">/* library state - support for</span></span><br><span class="line"><span class="comment">					 event driven applications */</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *mod_name;	<span class="comment">/* Name of the module currently executed */</span></span><br><span class="line">    <span class="keyword">int</span> mod_argc;               <span class="comment">/* Number of module arguments */</span></span><br><span class="line">    <span class="keyword">char</span> **mod_argv;            <span class="comment">/* module arguments */</span></span><br><span class="line">    <span class="keyword">int</span> choice;			<span class="comment">/* Which function we call from the module */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> HAVE_LIBAUDIT</span></span><br><span class="line">    <span class="keyword">int</span> audit_state;             <span class="comment">/* keep track of reported audit messages */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">pam_handle</span> <span class="title">pam_handle_t</span>;</span></span><br></pre></td></tr></table></figure></p>
<p>　　<br>　　② PAM库，这一层根据上层传过来的程序名、PAM参数等值，根据相应程序的配置文件来调用相应的模块。<br>　　③底层服务模块，这些模块去执行一些具体的事物，比如访问password、shadow等数据。<br>　　下面是PAM的文件系统：<br><img src="http://ohpezrhej.bkt.clouddn.com/image/2018/pam%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F.png" alt="PAM文件系统"><br>　　lib中PAM库和PAM模块的存放地。<br>　　etc下存放配置文件。<br>　　usr/include/下存放用到的头文件。</p>
<h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><p>　　配置文件中有三个字段，分别为：验证类别（type）、控制标准（flag）、PAM的模块与该模块的参数。</p>
<h3 id="模块类型-type"><a href="#模块类型-type" class="headerlink" title="模块类型(type)"></a>模块类型(type)</h3><table>
<thead>
<tr>
<th>类型</th>
<th>简介</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth</td>
<td>是authentication的缩写，所以主要用来验证用户的身份，通常需要密码来检验。</td>
</tr>
<tr>
<td>account</td>
<td>大部分是在进行授权，主要用来检验用户是否有正确的权限。</td>
</tr>
<tr>
<td>session</td>
<td>会议期间的意思，所以session管理的就是用户在这次登录期间PAM所给予的环境设置，比如用户登录与注销时的信息。如果经常使用su、sudo命令，会在/var/log/下的日志中发现许多“session open，session close ”的信息</td>
</tr>
<tr>
<td>password</td>
<td>密码，用于修改密码。</td>
</tr>
</tbody>
</table>
<p>　　四个类型的验证通常是有顺序的，不过也有例外。一般是先要验证(auth)用户身份，系统才能根据用户身份给予适当的授权与权限设置(account)，而登陆期间的环境配置需要设置，也需要记录登录与注销的信息(session)。如果运行期间需要修改密码，才会用的(password)。</p>
<h3 id="控制标志-control-flag"><a href="#控制标志-control-flag" class="headerlink" title="控制标志(control flag)"></a>控制标志(control flag)</h3><table>
<thead>
<tr>
<th>flag</th>
<th>简介</th>
</tr>
</thead>
<tbody>
<tr>
<td>requisite</td>
<td>如果失败就返回failure，并终止后续验证流程。如果成功就返回success并继续后面的流程。</td>
</tr>
<tr>
<td>required</td>
<td>不论成功或失败都会继续后面的验证流程，这样会有利于日志记录，这也是PAM最常使用此项的原因</td>
</tr>
<tr>
<td>sufficient</td>
<td>如果成功就返回success，并终止后续验证流程。如果失败就返回failure并继续后续流程。与requisite相反</td>
</tr>
<tr>
<td>optional</td>
<td>这个模块控件大多是在显示信息。</td>
</tr>
</tbody>
</table>
<h2 id="mylogin开发实例"><a href="#mylogin开发实例" class="headerlink" title="mylogin开发实例"></a>mylogin开发实例</h2><h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3><ul>
<li>ubuntu 18.04</li>
<li>对应系统的PAM源码</li>
<li>如果找不到头文件需要安装pam开发包 sudo apt-get install libpam0g-dev<h3 id="编写mylogin-c"><a href="#编写mylogin-c" class="headerlink" title="编写mylogin.c"></a>编写mylogin.c</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;security/pam_modules.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"md5.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PASS_SIZE 20</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> rightpass[PASS_SIZE];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">generatePass</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">time_t</span> t;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">tm</span> *<span class="title">p</span>;</span></span><br><span class="line">	time(&amp;t);</span><br><span class="line">	p=localtime(&amp;t);</span><br><span class="line">	<span class="comment">//获取月、日、小时</span></span><br><span class="line">	<span class="keyword">int</span> mon=p-&gt;tm_mon+<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">int</span> day=p-&gt;tm_mday;</span><br><span class="line">	<span class="keyword">int</span> hour=p-&gt;tm_hour;</span><br><span class="line">	mon*=mon;</span><br><span class="line">	day*=day;</span><br><span class="line">	hour*=hour;</span><br><span class="line">	<span class="keyword">int</span> tmp=mon+day+hour;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">char</span> strtmp[<span class="number">50</span>];</span><br><span class="line">	<span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(tmp!=<span class="number">0</span>)&#123;</span><br><span class="line">		strtmp[i++]=<span class="string">'0'</span>+(tmp%<span class="number">10</span>);</span><br><span class="line">		tmp/=<span class="number">10</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	strtmp[i]=<span class="string">'\0'</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//md5加密</span></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> encrypt[]=<span class="string">"  "</span>;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> decrypt[<span class="number">16</span>];    </span><br><span class="line">	<span class="keyword">int</span> j=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(j=<span class="number">0</span>;j&lt;i;j++)&#123;</span><br><span class="line">		encrypt[j]=strtmp[j];</span><br><span class="line">	&#125;</span><br><span class="line">	encrypt[i]=<span class="string">'\0'</span>;</span><br><span class="line">	<span class="comment">//printf("加密前:%s\n加密后:",encrypt);</span></span><br><span class="line">	MD5_CTX md5;</span><br><span class="line">	MD5Init(&amp;md5);         		</span><br><span class="line">	MD5Update(&amp;md5,encrypt,<span class="built_in">strlen</span>((<span class="keyword">char</span> *)encrypt));</span><br><span class="line">	MD5Final(&amp;md5,decrypt);        </span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"%02x"</span>,decrypt[i]);</span><br><span class="line">		<span class="built_in">sprintf</span>(rightpass+i*<span class="number">2</span>,<span class="string">"%02x"</span>,decrypt[i]);</span><br><span class="line">	&#125;</span><br><span class="line">	rightpass[<span class="number">6</span>]=<span class="string">'\0'</span>;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">PAM_EXTERN <span class="keyword">int</span> <span class="title">pam_sm_authenticate</span><span class="params">(<span class="keyword">pam_handle_t</span> *pamh,<span class="keyword">int</span> flags,<span class="keyword">int</span> argc,<span class="keyword">const</span> <span class="keyword">char</span> **argv)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> retval;</span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">char</span> *pUsername;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> *password;</span><br><span class="line">	generatePass();</span><br><span class="line">	retval = pam_get_user(pamh, &amp;pUsername, <span class="string">"username: "</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"Welcome %s\n------------------------------\n"</span>, pUsername);</span><br><span class="line">	<span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)&#123;</span><br><span class="line">		password=getpass(<span class="string">"Please input the extra password:"</span>);</span><br><span class="line">		<span class="keyword">int</span> j=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">if</span>(<span class="built_in">strcmp</span>(password,rightpass)==<span class="number">0</span>)&#123;</span><br><span class="line">			<span class="comment">//printf("%s ",password);</span></span><br><span class="line">			<span class="keyword">int</span> j=<span class="number">0</span>;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"password right!\n"</span>);</span><br><span class="line">			<span class="keyword">return</span> PAM_SUCCESS;</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"input error!\n"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"error 3 times!!!\n"</span>);</span><br><span class="line">	<span class="keyword">return</span> PAM_AUTH_ERR;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">PAM_EXTERN <span class="keyword">int</span> <span class="title">pam_sm_setcred</span><span class="params">(<span class="keyword">pam_handle_t</span> *pamh, <span class="keyword">int</span> flags, <span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> nret = PAM_SUCCESS, *pret;</span><br><span class="line">    pret = &amp;nret;</span><br><span class="line">    pam_get_data(pamh, <span class="string">"sample_setcred_return"</span>, (<span class="keyword">void</span> **)&amp;pret);</span><br><span class="line">    <span class="keyword">return</span> *pret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>　　在主函数中，调用了generatePass()生成额外的密码，然后与用户输入的进行对比。<br>　　如果输入正确则返回PAM_SUCCESS，如果输入错误就提示请重新输入密码。当错误三次之后就会返回PAM_AUTH_ERR。<br>　　在generatePass()中，首先对系统时间进行获取，然后分别获得当前的月、日、时，然后分别进行平方，再把三个平方的值相加。将其转化为字符串并逆序，再进行MD5加密，最后取十六进制的前六位作为额外的口令。</p>
<h3 id="编译-SO文件"><a href="#编译-SO文件" class="headerlink" title="编译.SO文件"></a>编译.SO文件</h3><p>　　使用gcc命令编译mylogin.c为.so文件，然后复制到 /lib/x86_64-linux-gnu/security/下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gcc -o mylogin.so -shared -fPIC mylogin.c md5.c -Ipam1</span><br><span class="line">cp mylogin.so /lib/x86_64-linux-gnu/security/</span><br></pre></td></tr></table></figure></p>
<h3 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h3><p>　　在/etc/pam.d/login 文件中最上面添加一行配置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auth requisite mylogin.so</span><br></pre></td></tr></table></figure></p>
<h3 id="运行login程序"><a href="#运行login程序" class="headerlink" title="运行login程序"></a>运行login程序</h3><p>　　当密码输入正确时：<br><img src="http://ophezrhej.bkt/clouddn.com/image/2018/login1.png" alt="login1"><br>　　密码输入错误超过三次时：<br>  <img src="http://ophezrhej.bkt/clouddn.com/image/2018/login2.png" alt="login2"></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>　　PAM是一种非常成熟的安全认证机制，可以为Linux多种应用提供安全可靠地认证服务，并且模块化的结构方便用户编写自己的PAM模块进行扩展。但是由于基础薄弱，对整个PAM的运行原理并没有深刻的理解。希望在以后的学习中，能够对PAM有更多的理解。</p>
<h2 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h2><p>MD5.c<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"md5.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> PADDING[]=&#123;<span class="number">0x80</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,</span><br><span class="line">		                         <span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,</span><br><span class="line">								 <span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,</span><br><span class="line">								<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MD5Init</span><span class="params">(MD5_CTX *context)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	context-&gt;count[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">	context-&gt;count[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">	context-&gt;state[<span class="number">0</span>] = <span class="number">0x67452301</span>;</span><br><span class="line">	context-&gt;state[<span class="number">1</span>] = <span class="number">0xEFCDAB89</span>;</span><br><span class="line">	context-&gt;state[<span class="number">2</span>] = <span class="number">0x98BADCFE</span>;</span><br><span class="line">	context-&gt;state[<span class="number">3</span>] = <span class="number">0x10325476</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MD5Update</span><span class="params">(MD5_CTX *context,<span class="keyword">unsigned</span> <span class="keyword">char</span> *input,<span class="keyword">unsigned</span> <span class="keyword">int</span> inputlen)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span> i = <span class="number">0</span>,index = <span class="number">0</span>,partlen = <span class="number">0</span>;</span><br><span class="line">	index = (context-&gt;count[<span class="number">0</span>] &gt;&gt; <span class="number">3</span>) &amp; <span class="number">0x3F</span>;</span><br><span class="line">	partlen = <span class="number">64</span> - index;</span><br><span class="line">	context-&gt;count[<span class="number">0</span>] += inputlen &lt;&lt; <span class="number">3</span>;</span><br><span class="line">	<span class="keyword">if</span>(context-&gt;count[<span class="number">0</span>] &lt; (inputlen &lt;&lt; <span class="number">3</span>))</span><br><span class="line">		context-&gt;count[<span class="number">1</span>]++;</span><br><span class="line">		context-&gt;count[<span class="number">1</span>] += inputlen &gt;&gt; <span class="number">29</span>;</span><br><span class="line">		<span class="keyword">if</span>(inputlen &gt;= partlen)&#123;</span><br><span class="line">			<span class="built_in">memcpy</span>(&amp;context-&gt;buffer[index],input,partlen);</span><br><span class="line">			MD5Transform(context-&gt;state,context-&gt;buffer);</span><br><span class="line">			<span class="keyword">for</span>(i = partlen;i+<span class="number">64</span> &lt;= inputlen;i+=<span class="number">64</span>)</span><br><span class="line">					MD5Transform(context-&gt;state,&amp;input[i]);</span><br><span class="line">					index = <span class="number">0</span>;</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			i = <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">memcpy</span>(&amp;context-&gt;buffer[index],&amp;input[i],inputlen-i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MD5Final</span><span class="params">(MD5_CTX *context,<span class="keyword">unsigned</span> <span class="keyword">char</span> digest[<span class="number">16</span>])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span> index = <span class="number">0</span>,padlen = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> bits[<span class="number">8</span>];</span><br><span class="line">	index = (context-&gt;count[<span class="number">0</span>] &gt;&gt; <span class="number">3</span>) &amp; <span class="number">0x3F</span>;</span><br><span class="line">	padlen = (index &lt; <span class="number">56</span>)?(<span class="number">56</span>-index):(<span class="number">120</span>-index);</span><br><span class="line">	MD5Encode(bits,context-&gt;count,<span class="number">8</span>);</span><br><span class="line">	MD5Update(context,PADDING,padlen);</span><br><span class="line">	MD5Update(context,bits,<span class="number">8</span>);</span><br><span class="line">	MD5Encode(digest,context-&gt;state,<span class="number">16</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MD5Encode</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> *output,<span class="keyword">unsigned</span> <span class="keyword">int</span> *input,<span class="keyword">unsigned</span> <span class="keyword">int</span> len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span> i = <span class="number">0</span>,j = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(j &lt; len)&#123;</span><br><span class="line">		output[j] = input[i] &amp; <span class="number">0xFF</span>;</span><br><span class="line">		output[j+<span class="number">1</span>] = (input[i] &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>;</span><br><span class="line">		output[j+<span class="number">2</span>] = (input[i] &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFF</span>;</span><br><span class="line">		output[j+<span class="number">3</span>] = (input[i] &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xFF</span>;</span><br><span class="line">		i++;</span><br><span class="line">		j+=<span class="number">4</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MD5Decode</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> *output,<span class="keyword">unsigned</span> <span class="keyword">char</span> *input,<span class="keyword">unsigned</span> <span class="keyword">int</span> len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span> i = <span class="number">0</span>,j = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(j &lt; len) &#123;</span><br><span class="line">		output[i] = (input[j]) |</span><br><span class="line">		(input[j+<span class="number">1</span>] &lt;&lt; <span class="number">8</span>) |</span><br><span class="line">		(input[j+<span class="number">2</span>] &lt;&lt; <span class="number">16</span>) |</span><br><span class="line">		 (input[j+<span class="number">3</span>] &lt;&lt; <span class="number">24</span>);</span><br><span class="line">		i++;</span><br><span class="line">		j+=<span class="number">4</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MD5Transform</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> state[<span class="number">4</span>],<span class="keyword">unsigned</span> <span class="keyword">char</span> block[<span class="number">64</span>])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span> a = state[<span class="number">0</span>];</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span> b = state[<span class="number">1</span>];</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span> c = state[<span class="number">2</span>];</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span> d = state[<span class="number">3</span>];</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span> x[<span class="number">64</span>];</span><br><span class="line">	MD5Decode(x,block,<span class="number">64</span>);</span><br><span class="line">	FF(a, b, c, d, x[ <span class="number">0</span>], <span class="number">7</span>, <span class="number">0xd76aa478</span>); <span class="comment">/* 1 */</span></span><br><span class="line">	FF(d, a, b, c, x[ <span class="number">1</span>], <span class="number">12</span>, <span class="number">0xe8c7b756</span>); <span class="comment">/* 2 */</span></span><br><span class="line">	FF(c, d, a, b, x[ <span class="number">2</span>], <span class="number">17</span>, <span class="number">0x242070db</span>); <span class="comment">/* 3 */</span></span><br><span class="line">	FF(b, c, d, a, x[ <span class="number">3</span>], <span class="number">22</span>, <span class="number">0xc1bdceee</span>); <span class="comment">/* 4 */</span></span><br><span class="line">	FF(a, b, c, d, x[ <span class="number">4</span>], <span class="number">7</span>, <span class="number">0xf57c0faf</span>); <span class="comment">/* 5 */</span></span><br><span class="line">	FF(d, a, b, c, x[ <span class="number">5</span>], <span class="number">12</span>, <span class="number">0x4787c62a</span>); <span class="comment">/* 6 */</span></span><br><span class="line">	FF(c, d, a, b, x[ <span class="number">6</span>], <span class="number">17</span>, <span class="number">0xa8304613</span>); <span class="comment">/* 7 */</span></span><br><span class="line">	FF(b, c, d, a, x[ <span class="number">7</span>], <span class="number">22</span>, <span class="number">0xfd469501</span>); <span class="comment">/* 8 */</span></span><br><span class="line">	FF(a, b, c, d, x[ <span class="number">8</span>], <span class="number">7</span>, <span class="number">0x698098d8</span>); <span class="comment">/* 9 */</span></span><br><span class="line">	FF(d, a, b, c, x[ <span class="number">9</span>], <span class="number">12</span>, <span class="number">0x8b44f7af</span>); <span class="comment">/* 10 */</span></span><br><span class="line">	FF(c, d, a, b, x[<span class="number">10</span>], <span class="number">17</span>, <span class="number">0xffff5bb1</span>); <span class="comment">/* 11 */</span></span><br><span class="line">	FF(b, c, d, a, x[<span class="number">11</span>], <span class="number">22</span>, <span class="number">0x895cd7be</span>); <span class="comment">/* 12 */</span></span><br><span class="line">	FF(a, b, c, d, x[<span class="number">12</span>], <span class="number">7</span>, <span class="number">0x6b901122</span>); <span class="comment">/* 13 */</span></span><br><span class="line">	FF(d, a, b, c, x[<span class="number">13</span>], <span class="number">12</span>, <span class="number">0xfd987193</span>); <span class="comment">/* 14 */</span></span><br><span class="line">	FF(c, d, a, b, x[<span class="number">14</span>], <span class="number">17</span>, <span class="number">0xa679438e</span>); <span class="comment">/* 15 */</span></span><br><span class="line">	FF(b, c, d, a, x[<span class="number">15</span>], <span class="number">22</span>, <span class="number">0x49b40821</span>); <span class="comment">/* 16 */</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Round 2 */</span></span><br><span class="line">	GG(a, b, c, d, x[ <span class="number">1</span>], <span class="number">5</span>, <span class="number">0xf61e2562</span>); <span class="comment">/* 17 */</span></span><br><span class="line">	GG(d, a, b, c, x[ <span class="number">6</span>], <span class="number">9</span>, <span class="number">0xc040b340</span>); <span class="comment">/* 18 */</span></span><br><span class="line">	GG(c, d, a, b, x[<span class="number">11</span>], <span class="number">14</span>, <span class="number">0x265e5a51</span>); <span class="comment">/* 19 */</span></span><br><span class="line">	GG(b, c, d, a, x[ <span class="number">0</span>], <span class="number">20</span>, <span class="number">0xe9b6c7aa</span>); <span class="comment">/* 20 */</span></span><br><span class="line">	GG(a, b, c, d, x[ <span class="number">5</span>], <span class="number">5</span>, <span class="number">0xd62f105d</span>); <span class="comment">/* 21 */</span></span><br><span class="line">	GG(d, a, b, c, x[<span class="number">10</span>], <span class="number">9</span>,  <span class="number">0x2441453</span>); <span class="comment">/* 22 */</span></span><br><span class="line">	GG(c, d, a, b, x[<span class="number">15</span>], <span class="number">14</span>, <span class="number">0xd8a1e681</span>); <span class="comment">/* 23 */</span></span><br><span class="line">	GG(b, c, d, a, x[ <span class="number">4</span>], <span class="number">20</span>, <span class="number">0xe7d3fbc8</span>); <span class="comment">/* 24 */</span></span><br><span class="line">	GG(a, b, c, d, x[ <span class="number">9</span>], <span class="number">5</span>, <span class="number">0x21e1cde6</span>); <span class="comment">/* 25 */</span></span><br><span class="line">	GG(d, a, b, c, x[<span class="number">14</span>], <span class="number">9</span>, <span class="number">0xc33707d6</span>); <span class="comment">/* 26 */</span></span><br><span class="line">	GG(c, d, a, b, x[ <span class="number">3</span>], <span class="number">14</span>, <span class="number">0xf4d50d87</span>); <span class="comment">/* 27 */</span></span><br><span class="line">	GG(b, c, d, a, x[ <span class="number">8</span>], <span class="number">20</span>, <span class="number">0x455a14ed</span>); <span class="comment">/* 28 */</span></span><br><span class="line">	GG(a, b, c, d, x[<span class="number">13</span>], <span class="number">5</span>, <span class="number">0xa9e3e905</span>); <span class="comment">/* 29 */</span></span><br><span class="line">	GG(d, a, b, c, x[ <span class="number">2</span>], <span class="number">9</span>, <span class="number">0xfcefa3f8</span>); <span class="comment">/* 30 */</span></span><br><span class="line">	GG(c, d, a, b, x[ <span class="number">7</span>], <span class="number">14</span>, <span class="number">0x676f02d9</span>); <span class="comment">/* 31 */</span></span><br><span class="line">	GG(b, c, d, a, x[<span class="number">12</span>], <span class="number">20</span>, <span class="number">0x8d2a4c8a</span>); <span class="comment">/* 32 */</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Round 3 */</span></span><br><span class="line">	HH(a, b, c, d, x[ <span class="number">5</span>], <span class="number">4</span>, <span class="number">0xfffa3942</span>); <span class="comment">/* 33 */</span></span><br><span class="line">	HH(d, a, b, c, x[ <span class="number">8</span>], <span class="number">11</span>, <span class="number">0x8771f681</span>); <span class="comment">/* 34 */</span></span><br><span class="line">	HH(c, d, a, b, x[<span class="number">11</span>], <span class="number">16</span>, <span class="number">0x6d9d6122</span>); <span class="comment">/* 35 */</span></span><br><span class="line">	HH(b, c, d, a, x[<span class="number">14</span>], <span class="number">23</span>, <span class="number">0xfde5380c</span>); <span class="comment">/* 36 */</span></span><br><span class="line">	HH(a, b, c, d, x[ <span class="number">1</span>], <span class="number">4</span>, <span class="number">0xa4beea44</span>); <span class="comment">/* 37 */</span></span><br><span class="line">	HH(d, a, b, c, x[ <span class="number">4</span>], <span class="number">11</span>, <span class="number">0x4bdecfa9</span>); <span class="comment">/* 38 */</span></span><br><span class="line">	HH(c, d, a, b, x[ <span class="number">7</span>], <span class="number">16</span>, <span class="number">0xf6bb4b60</span>); <span class="comment">/* 39 */</span></span><br><span class="line">	HH(b, c, d, a, x[<span class="number">10</span>], <span class="number">23</span>, <span class="number">0xbebfbc70</span>); <span class="comment">/* 40 */</span></span><br><span class="line">	HH(a, b, c, d, x[<span class="number">13</span>], <span class="number">4</span>, <span class="number">0x289b7ec6</span>); <span class="comment">/* 41 */</span></span><br><span class="line">	HH(d, a, b, c, x[ <span class="number">0</span>], <span class="number">11</span>, <span class="number">0xeaa127fa</span>); <span class="comment">/* 42 */</span></span><br><span class="line">	HH(c, d, a, b, x[ <span class="number">3</span>], <span class="number">16</span>, <span class="number">0xd4ef3085</span>); <span class="comment">/* 43 */</span></span><br><span class="line">	HH(b, c, d, a, x[ <span class="number">6</span>], <span class="number">23</span>,  <span class="number">0x4881d05</span>); <span class="comment">/* 44 */</span></span><br><span class="line">	HH(a, b, c, d, x[ <span class="number">9</span>], <span class="number">4</span>, <span class="number">0xd9d4d039</span>); <span class="comment">/* 45 */</span></span><br><span class="line">	HH(d, a, b, c, x[<span class="number">12</span>], <span class="number">11</span>, <span class="number">0xe6db99e5</span>); <span class="comment">/* 46 */</span></span><br><span class="line">	HH(c, d, a, b, x[<span class="number">15</span>], <span class="number">16</span>, <span class="number">0x1fa27cf8</span>); <span class="comment">/* 47 */</span></span><br><span class="line">	HH(b, c, d, a, x[ <span class="number">2</span>], <span class="number">23</span>, <span class="number">0xc4ac5665</span>); <span class="comment">/* 48 */</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Round 4 */</span></span><br><span class="line">	II(a, b, c, d, x[ <span class="number">0</span>], <span class="number">6</span>, <span class="number">0xf4292244</span>); <span class="comment">/* 49 */</span></span><br><span class="line">	II(d, a, b, c, x[ <span class="number">7</span>], <span class="number">10</span>, <span class="number">0x432aff97</span>); <span class="comment">/* 50 */</span></span><br><span class="line">	II(c, d, a, b, x[<span class="number">14</span>], <span class="number">15</span>, <span class="number">0xab9423a7</span>); <span class="comment">/* 51 */</span></span><br><span class="line">	II(b, c, d, a, x[ <span class="number">5</span>], <span class="number">21</span>, <span class="number">0xfc93a039</span>); <span class="comment">/* 52 */</span></span><br><span class="line">	II(a, b, c, d, x[<span class="number">12</span>], <span class="number">6</span>, <span class="number">0x655b59c3</span>); <span class="comment">/* 53 */</span></span><br><span class="line">	II(d, a, b, c, x[ <span class="number">3</span>], <span class="number">10</span>, <span class="number">0x8f0ccc92</span>); <span class="comment">/* 54 */</span></span><br><span class="line">	II(c, d, a, b, x[<span class="number">10</span>], <span class="number">15</span>, <span class="number">0xffeff47d</span>); <span class="comment">/* 55 */</span></span><br><span class="line">	II(b, c, d, a, x[ <span class="number">1</span>], <span class="number">21</span>, <span class="number">0x85845dd1</span>); <span class="comment">/* 56 */</span></span><br><span class="line">	II(a, b, c, d, x[ <span class="number">8</span>], <span class="number">6</span>, <span class="number">0x6fa87e4f</span>); <span class="comment">/* 57 */</span></span><br><span class="line">	II(d, a, b, c, x[<span class="number">15</span>], <span class="number">10</span>, <span class="number">0xfe2ce6e0</span>); <span class="comment">/* 58 */</span></span><br><span class="line">	II(c, d, a, b, x[ <span class="number">6</span>], <span class="number">15</span>, <span class="number">0xa3014314</span>); <span class="comment">/* 59 */</span></span><br><span class="line">	II(b, c, d, a, x[<span class="number">13</span>], <span class="number">21</span>, <span class="number">0x4e0811a1</span>); <span class="comment">/* 60 */</span></span><br><span class="line">	II(a, b, c, d, x[ <span class="number">4</span>], <span class="number">6</span>, <span class="number">0xf7537e82</span>); <span class="comment">/* 61 */</span></span><br><span class="line">	II(d, a, b, c, x[<span class="number">11</span>], <span class="number">10</span>, <span class="number">0xbd3af235</span>); <span class="comment">/* 62 */</span></span><br><span class="line">	II(c, d, a, b, x[ <span class="number">2</span>], <span class="number">15</span>, <span class="number">0x2ad7d2bb</span>); <span class="comment">/* 63 */</span></span><br><span class="line">	II(b, c, d, a, x[ <span class="number">9</span>], <span class="number">21</span>, <span class="number">0xeb86d391</span>); <span class="comment">/* 64 */</span></span><br><span class="line">	state[<span class="number">0</span>] += a;</span><br><span class="line">	state[<span class="number">1</span>] += b;</span><br><span class="line">	state[<span class="number">2</span>] += c;</span><br><span class="line">	state[<span class="number">3</span>] += d;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>MD5.h<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> MD5_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MD5_H</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">		    <span class="keyword">unsigned</span> <span class="keyword">int</span> count[<span class="number">2</span>];</span><br><span class="line">			    <span class="keyword">unsigned</span> <span class="keyword">int</span> state[<span class="number">4</span>];</span><br><span class="line">				    <span class="keyword">unsigned</span> <span class="keyword">char</span> buffer[<span class="number">64</span>];</span><br><span class="line">&#125;MD5_CTX;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> F(x,y,z) ((x &amp; y) | (~x &amp; z))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> G(x,y,z) ((x &amp; z) | (y &amp; ~z))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> H(x,y,z) (x^y^z)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> I(x,y,z) (y ^ (x | ~z))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ROTATE_LEFT(x,n) ((x <span class="meta-string">&lt;&lt; n) | (x &gt;&gt; (32-n)))</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> FF(a,b,c,d,x,s,ac) \</span></span><br><span class="line">		          &#123; \</span><br><span class="line">						            a += F(b,c,d) + x + ac; \</span><br><span class="line">						            a = ROTATE_LEFT(a,s); \</span><br><span class="line">						            a += b; \</span><br><span class="line">						            &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> GG(a,b,c,d,x,s,ac) \</span></span><br><span class="line">		          &#123; \</span><br><span class="line">						            a += G(b,c,d) + x + ac; \</span><br><span class="line">						            a = ROTATE_LEFT(a,s); \</span><br><span class="line">						            a += b; \</span><br><span class="line">						            &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> HH(a,b,c,d,x,s,ac) \</span></span><br><span class="line">		          &#123; \</span><br><span class="line">						            a += H(b,c,d) + x + ac; \</span><br><span class="line">						            a = ROTATE_LEFT(a,s); \</span><br><span class="line">						            a += b; \</span><br><span class="line">						            &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> II(a,b,c,d,x,s,ac) \</span></span><br><span class="line">		          &#123; \</span><br><span class="line">						            a += I(b,c,d) + x + ac; \</span><br><span class="line">						            a = ROTATE_LEFT(a,s); \</span><br><span class="line">						            a += b; \</span><br><span class="line">						            &#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MD5Init</span><span class="params">(MD5_CTX *context)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MD5Update</span><span class="params">(MD5_CTX *context,<span class="keyword">unsigned</span> <span class="keyword">char</span> *input,<span class="keyword">unsigned</span> <span class="keyword">int</span> inputlen)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MD5Final</span><span class="params">(MD5_CTX *context,<span class="keyword">unsigned</span> <span class="keyword">char</span> digest[<span class="number">16</span>])</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MD5Transform</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> state[<span class="number">4</span>],<span class="keyword">unsigned</span> <span class="keyword">char</span> block[<span class="number">64</span>])</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MD5Encode</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> *output,<span class="keyword">unsigned</span> <span class="keyword">int</span> *input,<span class="keyword">unsigned</span> <span class="keyword">int</span> len)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MD5Decode</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> *output,<span class="keyword">unsigned</span> <span class="keyword">char</span> *input,<span class="keyword">unsigned</span> <span class="keyword">int</span> len)</span></span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure></p>
<p>欢迎与我分享你的看法。<br>转载请注明出处：<a href="http://taowusheng.cn/" target="_blank" rel="noopener">http://taowusheng.cn/</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/10/21/20181021 PAM_验证模块开发实例/" data-id="cjo4e1z3s003h60bj9z9934cp" class="article-share-link">Share</a>
      
      
        <a href="/2018/10/21/20181021 PAM_验证模块开发实例/#comments" class="article-comment-link">
          <span class="post-comments-count valine-comment-count" data-xid="/2018/10/21/20181021 PAM_验证模块开发实例/" itemprop="commentCount"></span>
          Comments
        </a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/auth/">auth</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/kernal/">kernal</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/">linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pam/">pam</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2018/10/27/20181027 密码学知识总结/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          密码学知识总结
        
      </div>
    </a>
  
  
    <a href="/2018/10/09/20181009 动态规划_01背包_一维数组_路径记录/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">动态规划_01背包_一维数组_路径记录</div>
    </a>
  
</nav>

  
</article>



  <section id="comments" class="vcomment">

  </section>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/ACM-Algorithm/">ACM_&_Algorithm</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/CTF/">CTF</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JAVA/">JAVA</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux-Kernel/">Linux_Kernel</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/SQL/">SQL</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/cryptography/">cryptography</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/life/">life</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/reading/">reading</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/thought/">thought</a><span class="category-list-count">4</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/01背包/" style="font-size: 10px;">01背包</a> <a href="/tags/ACM/" style="font-size: 17.5px;">ACM</a> <a href="/tags/CTF/" style="font-size: 10px;">CTF</a> <a href="/tags/DES/" style="font-size: 10px;">DES</a> <a href="/tags/GUI/" style="font-size: 10px;">GUI</a> <a href="/tags/IO/" style="font-size: 10px;">IO</a> <a href="/tags/JAVA/" style="font-size: 20px;">JAVA</a> <a href="/tags/Linux/" style="font-size: 12.5px;">Linux</a> <a href="/tags/RSA/" style="font-size: 10px;">RSA</a> <a href="/tags/SHA/" style="font-size: 10px;">SHA</a> <a href="/tags/SQL/" style="font-size: 10px;">SQL</a> <a href="/tags/SSL/" style="font-size: 10px;">SSL</a> <a href="/tags/Thread/" style="font-size: 10px;">Thread</a> <a href="/tags/UDP/" style="font-size: 10px;">UDP</a> <a href="/tags/auth/" style="font-size: 10px;">auth</a> <a href="/tags/bellman/" style="font-size: 10px;">bellman</a> <a href="/tags/cryptography/" style="font-size: 12.5px;">cryptography</a> <a href="/tags/dijkstra/" style="font-size: 10px;">dijkstra</a> <a href="/tags/floyd/" style="font-size: 10px;">floyd</a> <a href="/tags/jdbc/" style="font-size: 10px;">jdbc</a> <a href="/tags/kernal/" style="font-size: 10px;">kernal</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/mail服务器/" style="font-size: 10px;">mail服务器</a> <a href="/tags/md5注入/" style="font-size: 10px;">md5注入</a> <a href="/tags/pam/" style="font-size: 10px;">pam</a> <a href="/tags/postfix/" style="font-size: 10px;">postfix</a> <a href="/tags/reading/" style="font-size: 10px;">reading</a> <a href="/tags/thought/" style="font-size: 10px;">thought</a> <a href="/tags/书单/" style="font-size: 10px;">书单</a> <a href="/tags/公钥/" style="font-size: 10px;">公钥</a> <a href="/tags/公钥密码/" style="font-size: 10px;">公钥密码</a> <a href="/tags/动态规划/" style="font-size: 10px;">动态规划</a> <a href="/tags/北京工业大学/" style="font-size: 10px;">北京工业大学</a> <a href="/tags/多线程/" style="font-size: 10px;">多线程</a> <a href="/tags/密码体制/" style="font-size: 10px;">密码体制</a> <a href="/tags/密码学/" style="font-size: 12.5px;">密码学</a> <a href="/tags/对称密码/" style="font-size: 10px;">对称密码</a> <a href="/tags/年终总结/" style="font-size: 10px;">年终总结</a> <a href="/tags/异常处理/" style="font-size: 10px;">异常处理</a> <a href="/tags/思考/" style="font-size: 15px;">思考</a> <a href="/tags/总结/" style="font-size: 15px;">总结</a> <a href="/tags/挑战程序设计竞赛/" style="font-size: 12.5px;">挑战程序设计竞赛</a> <a href="/tags/摄影/" style="font-size: 10px;">摄影</a> <a href="/tags/数据库/" style="font-size: 12.5px;">数据库</a> <a href="/tags/最短路径算法/" style="font-size: 10px;">最短路径算法</a> <a href="/tags/生活随笔/" style="font-size: 10px;">生活随笔</a> <a href="/tags/碎碎念/" style="font-size: 10px;">碎碎念</a> <a href="/tags/私钥/" style="font-size: 10px;">私钥</a> <a href="/tags/立flag/" style="font-size: 10px;">立flag</a> <a href="/tags/经历/" style="font-size: 10px;">经历</a> <a href="/tags/网络编程/" style="font-size: 10px;">网络编程</a> <a href="/tags/考研/" style="font-size: 10px;">考研</a> <a href="/tags/计划/" style="font-size: 10px;">计划</a> <a href="/tags/计算机技术/" style="font-size: 10px;">计算机技术</a> <a href="/tags/读书笔记/" style="font-size: 12.5px;">读书笔记</a> <a href="/tags/面向对象/" style="font-size: 10px;">面向对象</a> <a href="/tags/黑客与画家/" style="font-size: 10px;">黑客与画家</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/12/31/20181231 2018年书单/">2018年书单</a>
          </li>
        
          <li>
            <a href="/2018/10/29/20181029 SSL协议的基本原理/">SSL协议的基本原理</a>
          </li>
        
          <li>
            <a href="/2018/10/27/20181027 密码学知识总结/">密码学知识总结</a>
          </li>
        
          <li>
            <a href="/2018/10/21/20181021 PAM_验证模块开发实例/">PAM_验证模块开发实例</a>
          </li>
        
          <li>
            <a href="/2018/10/09/20181009 动态规划_01背包_一维数组_路径记录/">动态规划_01背包_一维数组_路径记录</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">visiters</h3>
    <div class="widget">
      <script type="text/javascript" src="//rf.revolvermaps.com/0/0/8.js?i=534a4dn9fi8&amp;m=0c&amp;c=ff0000&amp;cr1=ffffff&amp;f=ubuntu&amp;l=0&amp;cw=ffffff&amp;cb=000000" async="async"></script>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016-2018 Tao WuSheng<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/links" class="mobile-nav-link">Links</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>




  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
<script>
    var GUEST_INFO = ['nick','mail','link'];
    var guest_info = 'nick,mail,link'.split(',').filter(function(item){
        return GUEST_INFO.indexOf(item) > -1
    });
    var notify = 'false' == true;
    var verify = 'false' == true;
    new Valine({
        el: '.vcomment',
        notify: notify,
        verify: verify,
        appId: "IwNQge9YG0FIzuQKmRVrBgCL-gzGzoHsz",
        appKey: "IP8hmPLhobMvvjpkfm1OKzuv",
        placeholder: "Please leave your footprints...",
        pageSize:'10',
        avatar:'mm',
        lang:'zh-cn'
    });
</script>

  </div>
</body>
</html>