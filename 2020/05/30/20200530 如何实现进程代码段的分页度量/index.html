<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'true', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-89376999-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-89376999-1');
</script>



  
  <title>如何实现进程代码段的分页度量 | YIFEI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="之前通过读取/proc/pid/mem的方法读取某个进程的内存数据，mem内部是用copy_from_user实现的，是对虚拟地址进行的操作。但是在某一时刻，该进程的所有内存页不一定都已经被加载到内存。由于虚拟内存的存在，只有那页代码被访问到时(copy_from_user()会判断缺页的情况)，才会产生缺页中断，将该页代码加载到内存。这种方式并不够理想，理想的方法是判断哪些数据页已加载到内存中，">
<meta name="keywords" content="Linux_Kernel,memory,内存管理">
<meta property="og:type" content="article">
<meta property="og:title" content="如何实现进程代码段的分页度量">
<meta property="og:url" content="http://taowusheng.cn/2020/05/30/20200530 如何实现进程代码段的分页度量/index.html">
<meta property="og:site_name" content="YIFEI">
<meta property="og:description" content="之前通过读取/proc/pid/mem的方法读取某个进程的内存数据，mem内部是用copy_from_user实现的，是对虚拟地址进行的操作。但是在某一时刻，该进程的所有内存页不一定都已经被加载到内存。由于虚拟内存的存在，只有那页代码被访问到时(copy_from_user()会判断缺页的情况)，才会产生缺页中断，将该页代码加载到内存。这种方式并不够理想，理想的方法是判断哪些数据页已加载到内存中，">
<meta property="og:locale" content="default">
<meta property="og:image" content="http://taowusheng.cn/images_/2020_picture/20200530_virtualAddress_physicalAddress.jpg">
<meta property="og:updated_time" content="2022-10-28T15:11:58.398Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="如何实现进程代码段的分页度量">
<meta name="twitter:description" content="之前通过读取/proc/pid/mem的方法读取某个进程的内存数据，mem内部是用copy_from_user实现的，是对虚拟地址进行的操作。但是在某一时刻，该进程的所有内存页不一定都已经被加载到内存。由于虚拟内存的存在，只有那页代码被访问到时(copy_from_user()会判断缺页的情况)，才会产生缺页中断，将该页代码加载到内存。这种方式并不够理想，理想的方法是判断哪些数据页已加载到内存中，">
<meta name="twitter:image" content="http://taowusheng.cn/images_/2020_picture/20200530_virtualAddress_physicalAddress.jpg">
  
    <link rel="alternate" href="/atom.xml" title="YIFEI" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="/googleapis-fonts/fonts.css" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

  
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">YIFEI</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">每当我找到生命的意义，它就又变了...</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/links">Links</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://taowusheng.cn"></form>
      </div>
    </div>
  </div>
	
  <script>
    
    var number_of_banners = 8;
    var randnum = Math.floor(Math.random() * number_of_banners + 1);
    document.getElementById("banner").style.backgroundImage = "url(/css/images/banner" + randnum + ".jpg)";
    
</script>

</header>
      <div class="outer">
        <section id="main"><article id="post-20200530 如何实现进程代码段的分页度量" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/05/30/20200530 如何实现进程代码段的分页度量/" class="article-date">
  <time datetime="2020-05-30T00:00:01.000Z" itemprop="datePublished">2020-05-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Linux-Kernel/">Linux_Kernel</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      如何实现进程代码段的分页度量
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
		<!-- Table of Contents -->
		
		  <div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
			<ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#使用方法"><span class="toc-number">1.</span> <span class="toc-text">使用方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#读取物理内存"><span class="toc-number">2.</span> <span class="toc-text">读取物理内存</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#虚拟地址转换为物理地址"><span class="toc-number">3.</span> <span class="toc-text">虚拟地址转换为物理地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分页度量进程的代码段"><span class="toc-number">4.</span> <span class="toc-text">分页度量进程的代码段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#知识点记录"><span class="toc-number">5.</span> <span class="toc-text">知识点记录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#问题记录"><span class="toc-number">6.</span> <span class="toc-text">问题记录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#参考"><span class="toc-number">7.</span> <span class="toc-text">参考</span></a></li></ol>
		  </div>
		
        <p>之前通过<a href="http://taowusheng.cn/2019/09/23/20190923%20%E5%A6%82%E4%BD%95%E8%AF%BB%E5%8F%96Linux%E8%BF%9B%E7%A8%8B%E4%B8%AD%E7%9A%84%E4%BB%A3%E7%A0%81%E6%AE%B5%E5%92%8C%E6%95%B0%E6%8D%AE%E6%AE%B5/">读取/proc/pid/mem的方法</a>读取某个进程的内存数据，mem内部是用copy_from_user实现的，是对虚拟地址进行的操作。但是在某一时刻，该进程的所有内存页不一定都已经被加载到内存。由于虚拟内存的存在，只有那页代码被访问到时(copy_from_user()会判断缺页的情况)，才会产生缺页中断，将该页代码加载到内存。这种方式并不够理想，理想的方法是判断哪些数据页已加载到内存中，然后对其进行度量。        <a id="more"></a></p>
<p>在google一番后，发现有三个小程序涉及到的知识可以完成这一任务，第一个是dram.c，用来创建字符设备，这个字符设备将物理内存虚拟为一个dev/dram文件。第二个是fileview.cpp，用来读取dram文件，从而获取物理内存页的数据。第三个是translate.c，用来将虚拟地址转换为物理地址。</p>
<p>这样编写一个内核模块，就可以实现对进程代码段的分页度量了。以下是三个小程序的使用方法、代码注释、内核模块。</p>
<h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cd Access_Physical_Memory</span><br><span class="line">make	#编译dram.ko</span><br><span class="line">insmod dram.ko	#加载内核模块</span><br><span class="line">mknod /dev/dram c 85 0	#创建字符设备，设备号设置为85</span><br><span class="line">g++ fileview.cpp -o fileview</span><br><span class="line">./fileview /dev/dram</span><br><span class="line">再输入回车，可以输入物理地址</span><br></pre></td></tr></table></figure>
<h3 id="读取物理内存"><a href="#读取物理内存" class="headerlink" title="读取物理内存"></a>读取物理内存</h3><ul>
<li><p>字符设备dram.c。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//-------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">//	dram.c</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	This module implements a Linux character-mode device-driver</span></span><br><span class="line"><span class="comment">//	for the processor's installed physical memory.  It utilizes</span></span><br><span class="line"><span class="comment">//	the kernel's 'kmap()' function, as a uniform way to provide  </span></span><br><span class="line"><span class="comment">//	access to all the memory-zones (including the "high memory"</span></span><br><span class="line"><span class="comment">//	on systems with more than 896MB of installed physical ram). </span></span><br><span class="line"><span class="comment">//	The access here is 'read-only' because we deem it too risky </span></span><br><span class="line"><span class="comment">//	to the stable functioning of our system to allow every user</span></span><br><span class="line"><span class="comment">//	the unrestricted ability to arbitrarily modify memory-areas</span></span><br><span class="line"><span class="comment">//	which might contain some "critical" kernel data-structures.</span></span><br><span class="line"><span class="comment">//	We implement an 'llseek()' method so that users can readily </span></span><br><span class="line"><span class="comment">//	find out how much physical processor-memory is installed. </span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	<span class="doctag">NOTE:</span> Developed and tested with Linux kernel version 2.6.10</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	programmer: ALLAN CRUSE</span></span><br><span class="line"><span class="comment">//	written on: 30 JAN 2005</span></span><br><span class="line"><span class="comment">//	revised on: 28 JAN 2008 -- for Linux kernel version 2.6.22.5</span></span><br><span class="line"><span class="comment">//	revised on: 06 FEB 2008 -- for machines having 4GB of memory</span></span><br><span class="line"><span class="comment">//-------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/module.h&gt;	// for module_init() </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/highmem.h&gt;	// for kmap(), kunmap()</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;asm/uaccess.h&gt;	// for copy_to_user() </span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> modname[] = <span class="string">"dram"</span>;	<span class="comment">// for displaying driver's name</span></span><br><span class="line"><span class="keyword">int</span> my_major = <span class="number">85</span>;		<span class="comment">// note static major assignment </span></span><br><span class="line"><span class="keyword">loff_t</span> 	dram_size;		<span class="comment">// total bytes of system memory</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">#ifdef __GNUC__</span></span><br><span class="line"><span class="comment">        typedef long long       __kernel_loff_t;</span></span><br><span class="line"><span class="comment">#endif</span></span><br><span class="line"><span class="comment">#if defined(__GNUC__)</span></span><br><span class="line"><span class="comment">        typedef __kernel_loff_t         loff_t;</span></span><br><span class="line"><span class="comment">#endif</span></span><br><span class="line"><span class="comment">loff_t 是一个long long类型</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">loff_t</span> my_llseek( struct file *file, <span class="keyword">loff_t</span> offset, <span class="keyword">int</span> whence );</span><br><span class="line"><span class="keyword">ssize_t</span> my_read( struct file *file, <span class="keyword">char</span> *buf, <span class="keyword">size_t</span> count, <span class="keyword">loff_t</span> *pos );</span><br><span class="line"></span><br><span class="line"><span class="comment">//指定成员赋值，cpp不支持</span></span><br><span class="line"><span class="comment">//该结构体里都是函数指针，llseek用于改变文件的当前读写位置。read用于从设备获取数据。</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">file_operations</span> </span></span><br><span class="line"><span class="class"><span class="title">my_fops</span> =	&#123;</span></span><br><span class="line">		owner:		THIS_MODULE,</span><br><span class="line">		llseek:		my_llseek,</span><br><span class="line">		read:		my_read,</span><br><span class="line">		&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> __<span class="function">init <span class="title">dram_init</span><span class="params">( <span class="keyword">void</span> )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	printk( <span class="string">"&lt;1&gt;\nInstalling \'%s\' module "</span>, modname );</span><br><span class="line">	printk( <span class="string">"(major=%d)\n"</span>, my_major );</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//get_num_physpages()获取 所有物理内存减去内核所保留内存块后的剩余内存(是内存地址数，不是内存页数)。</span></span><br><span class="line">	dram_size = (<span class="keyword">loff_t</span>)get_num_physpages() &lt;&lt; PAGE_SHIFT;</span><br><span class="line">	<span class="comment">// %08llX 前补0，域宽8位，大写16进制输出</span></span><br><span class="line">	printk( <span class="string">"&lt;1&gt;  ramtop=%08llX (%llu MB)\n"</span>, dram_size, dram_size &gt;&gt; <span class="number">20</span> );</span><br><span class="line">	<span class="comment">//register_chrdev注册字符设备，</span></span><br><span class="line">	<span class="keyword">return</span> 	register_chrdev( my_major, modname, &amp;my_fops );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> __<span class="function"><span class="built_in">exit</span> <span class="title">dram_exit</span><span class="params">( <span class="keyword">void</span> )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">//取消字符设备注册</span></span><br><span class="line">	unregister_chrdev( my_major, modname );</span><br><span class="line">	printk( <span class="string">"&lt;1&gt;Removing \'%s\' module\n"</span>, modname );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">file：为进行读取信息的目标文件，</span></span><br><span class="line"><span class="comment">buf：为对应放置信息的缓冲区（即用户空间内存地址）；</span></span><br><span class="line"><span class="comment">count：为要读取的信息长度；</span></span><br><span class="line"><span class="comment">pos：为读的位置相对于文件开头的偏移，这里的pos是想读取的物理地址</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">ssize_t</span> my_read( struct file *file, <span class="keyword">char</span> *buf, <span class="keyword">size_t</span> count, <span class="keyword">loff_t</span> *pos )</span><br><span class="line">&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">page</span>	*<span class="title">pp</span>;</span></span><br><span class="line">	<span class="keyword">void</span>		*from;</span><br><span class="line">	<span class="keyword">int</span>		page_number, page_indent, more;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// we cannot read beyond the end-of-file</span></span><br><span class="line">	<span class="comment">//如果读取位置超出物理内存尺寸，则退出</span></span><br><span class="line">	<span class="keyword">if</span> ( *pos &gt;= dram_size ) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// determine which physical page to temporarily map</span></span><br><span class="line">	<span class="comment">// and how far into that page to begin reading from </span></span><br><span class="line">	<span class="comment">//根据物理地址计算对应页号</span></span><br><span class="line">	page_number = *pos / PAGE_SIZE;</span><br><span class="line">	<span class="comment">//计算页内偏移</span></span><br><span class="line">	page_indent = *pos % PAGE_SIZE;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// map the designated physical page into kernel space</span></span><br><span class="line">	<span class="comment">//If kerel vesion is 2.6.32 or later, please use pfn_to_page() to get page, and include</span></span><br><span class="line">	<span class="comment">//	asm-generic/memory_model.h</span></span><br><span class="line">	<span class="comment">//这里我的内核是3.16.82，所以改成if 1</span></span><br><span class="line">	</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> 1</span></span><br><span class="line">	<span class="comment">//根据物理页号获取mem_map数组中相应地址</span></span><br><span class="line">    pp = pfn_to_page( page_number);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">	pp = &amp;mem_map[ page_number ];</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">//kmap在永久内核映射区，创建高端页框(物理页)到内核地址空间(线性地址)的长期映射</span></span><br><span class="line">	from = kmap( pp ) + page_indent;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// cannot reliably read beyond the end of this mapped page</span></span><br><span class="line">	<span class="comment">//每次只读取不超过一页的数据</span></span><br><span class="line">	<span class="keyword">if</span> ( page_indent + count &gt; PAGE_SIZE ) count = PAGE_SIZE - page_indent;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// now transfer count bytes from mapped page to user-supplied buffer 	</span></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	unsigned long copy_to_user(void *to, const void *from, unsigned long n)</span></span><br><span class="line"><span class="comment">		to:目标地址（用户空间）</span></span><br><span class="line"><span class="comment">		from:源地址（内核空间）</span></span><br><span class="line"><span class="comment">		n:将要拷贝数据的字节数</span></span><br><span class="line"><span class="comment">		返回：成功返回0，失败返回没有拷贝成功的数据字节数</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	more = copy_to_user( buf, from, count );</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// ok now to discard the temporary page mapping</span></span><br><span class="line">	<span class="comment">//删除之前的映射</span></span><br><span class="line">	kunmap( pp );</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// an error occurred if less than count bytes got copied</span></span><br><span class="line">	<span class="keyword">if</span> ( more ) <span class="keyword">return</span> -EFAULT;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// otherwise advance file-pointer and report number of bytes read</span></span><br><span class="line">	<span class="comment">//往后推进读取位置，返回读取的字节数</span></span><br><span class="line">	*pos += count;</span><br><span class="line">	<span class="keyword">return</span>	count;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">重新定位文件读写偏移量</span></span><br><span class="line"><span class="comment">whence有以下取值：</span></span><br><span class="line"><span class="comment">    SEEK_SET    偏移量设置为offset字节。</span></span><br><span class="line"><span class="comment">    SEEK_CUR    偏移量设置为当前位置加上offset字节。</span></span><br><span class="line"><span class="comment">    SEEK_END    偏移量设置为文件大小加上偏移字节大小。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">loff_t</span> my_llseek( struct file *file, <span class="keyword">loff_t</span> offset, <span class="keyword">int</span> whence )</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">loff_t</span>	newpos = <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">switch</span>( whence )</span><br><span class="line">		&#123;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">0</span>: newpos = offset; <span class="keyword">break</span>;					<span class="comment">// SEEK_SET</span></span><br><span class="line">		<span class="keyword">case</span> <span class="number">1</span>: newpos = file-&gt;f_pos + offset; <span class="keyword">break</span>; 	<span class="comment">// SEEK_CUR</span></span><br><span class="line">		<span class="keyword">case</span> <span class="number">2</span>: newpos = dram_size + offset; <span class="keyword">break</span>; 	<span class="comment">// SEEK_END</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (( newpos &lt; <span class="number">0</span> )||( newpos &gt; dram_size )) <span class="keyword">return</span> -EINVAL;</span><br><span class="line">	file-&gt;f_pos = newpos;</span><br><span class="line">	<span class="keyword">return</span>	newpos;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MODULE_LICENSE(<span class="string">"GPL"</span>);</span><br><span class="line">module_init( dram_init );</span><br><span class="line">module_exit( dram_exit );</span><br></pre></td></tr></table></figure>
</li>
<li><p>fileview.cpp文件用来读取dev/dram字符设备，并输出内存页上的数据。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//----------------------------------------------------------------</span></span><br><span class="line"><span class="comment">//	fileview.cpp</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	This program displays the contents of a specified file </span></span><br><span class="line"><span class="comment">//	in hexadecimal and ascii formats (including any device</span></span><br><span class="line"><span class="comment">//	special files representing storage media).  A user may</span></span><br><span class="line"><span class="comment">//	navigate the file's contents using arrow-key commands,</span></span><br><span class="line"><span class="comment">//	or may adjust the format of the hexadecimal display to</span></span><br><span class="line"><span class="comment">//	select from among five data-sizes: byte (B), word (W), </span></span><br><span class="line"><span class="comment">//	doubleword (D), quadword (Q) or octaword (O).  It also</span></span><br><span class="line"><span class="comment">//	is possible to seek to a specified position within the</span></span><br><span class="line"><span class="comment">//	file by hitting the &lt;ENTER&gt;-key and then typing in the</span></span><br><span class="line"><span class="comment">//	desired (hexadecimal) address.  Type &lt;ESCAPE&gt; to quit.  </span></span><br><span class="line">	此程序以十六进制和ascii格式显示指定文件的内容（包括表示存储介质的任何设备专用文件）</span><br><span class="line">	用户可以使用箭头键命令浏览文件内容，也可以调整十六进制显示的格式，</span><br><span class="line">	以便从五种数据大小中进行选择：字节（B）、字（W）、双字（D）、四字（Q）或八字（O）。</span><br><span class="line">	也可以通过按&lt;ENTER&gt;键，然后键入所需的（十六进制）地址，在文件中查找到指定的位置。</span><br><span class="line">	键入&lt;ESCAPE&gt;退出。</span><br><span class="line"><span class="comment">//	       compile-and-link using: $ make fileview</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	programmer: ALLAN CRUSE</span></span><br><span class="line"><span class="comment">//	written on: 26 OCT 2002</span></span><br><span class="line"><span class="comment">//	revised on: 07 JUN 2006 -- removed reliance on 'ncurses' </span></span><br><span class="line"><span class="comment">//----------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;	// for printf(), perror(), fflush() </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;	// for open()</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;	// for strncpy()</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;	// for read(), lseek64()</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;	// for exit()</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;termios.h&gt;	// for tcgetattr(), tcsetattr()</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXNAME	80</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BUFHIGH 16	<span class="comment">//用十六进制输出内存数据时的行数为16</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BUFWIDE 16	<span class="comment">//用十六进制输出内存数据时的宽度为16</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BUFSIZE 256</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ROW	6</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> COL	2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//键盘按键</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> KB_SEEK 0x0000000A</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> KB_QUIT	0x0000001B</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> KB_BACK 0x0000007F</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> KB_HOME	0x00315B1B</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> KB_LNUP 0x00415B1B</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> KB_PGUP	0x00355B1B</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> KB_LEFT 0x00445B1B</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> KB_RGHT 0x00435B1B</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> KB_LNDN 0x00425B1B</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> KB_PGDN 0x00365B1B</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> KB_END  0x00345B1B</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> KB_DEL  0x00335B1B</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> progname[] = <span class="string">"FILEVIEW"</span>;</span><br><span class="line"><span class="keyword">char</span> filename[ MAXNAME + <span class="number">1</span> ];</span><br><span class="line"><span class="keyword">char</span> buffer[ BUFSIZE ];</span><br><span class="line"><span class="keyword">char</span> outline[ <span class="number">80</span> ];</span><br><span class="line"></span><br><span class="line"><span class="comment">// ./fileview /dev/dram</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[] )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// setup the filename (if supplied), else terminate</span></span><br><span class="line">	<span class="comment">//此时artv[1]为dev/dram</span></span><br><span class="line">	<span class="keyword">if</span> ( argc &gt; <span class="number">1</span> ) <span class="built_in">strncpy</span>( filename, argv[<span class="number">1</span>], MAXNAME );</span><br><span class="line"> 	<span class="keyword">else</span> &#123; <span class="built_in">fprintf</span>( <span class="built_in">stderr</span>, <span class="string">"argument needed\n"</span> ); <span class="built_in">exit</span>(<span class="number">1</span>); &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// open the file for reading</span></span><br><span class="line">	<span class="comment">//以只读模式打开/dev/dram字符设备</span></span><br><span class="line">	<span class="keyword">int</span>	fd = open( filename, O_RDONLY );</span><br><span class="line">	<span class="keyword">if</span> ( fd &lt; <span class="number">0</span> ) &#123; perror( filename ); <span class="built_in">exit</span>(<span class="number">1</span>); &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// obtain the filesize (if possible)</span></span><br><span class="line">	<span class="comment">//lseek64用于大文件内的读写位置跳转(可以设置64位的地址),返回相对于文件首的偏移量</span></span><br><span class="line">	<span class="keyword">long</span> <span class="keyword">long</span>	filesize = lseek64( fd, <span class="number">0L</span>L, SEEK_END );</span><br><span class="line">	<span class="keyword">if</span> ( filesize &lt; <span class="number">0L</span>L ) </span><br><span class="line">		&#123; </span><br><span class="line">		<span class="built_in">fprintf</span>( <span class="built_in">stderr</span>, <span class="string">"cannot locate \'end-of-file\' \n"</span> ); </span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">1</span>); </span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">long</span> <span class="keyword">long</span>	incmin = ( <span class="number">1L</span>L &lt;&lt;  <span class="number">8</span> );</span><br><span class="line">	<span class="keyword">long</span> <span class="keyword">long</span>	incmax = ( <span class="number">1L</span>L &lt;&lt; <span class="number">36</span> );		</span><br><span class="line">	<span class="keyword">long</span> <span class="keyword">long</span>	posmin = <span class="number">0L</span>L;</span><br><span class="line">	<span class="keyword">long</span> <span class="keyword">long</span>	posmax = (filesize - <span class="number">241L</span>L)&amp;~<span class="number">0xF</span>;</span><br><span class="line">	<span class="keyword">if</span> ( posmax &lt; posmin ) posmax = posmin;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// initiate noncanonical terminal input</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">termios</span>	<span class="title">tty_orig</span>;</span></span><br><span class="line">	<span class="comment">//获取终端相关参数，第一个参数是fd，</span></span><br><span class="line">	tcgetattr( STDIN_FILENO, &amp;tty_orig );</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">termios</span>	<span class="title">tty_work</span> = <span class="title">tty_orig</span>;</span></span><br><span class="line">	<span class="comment">//关闭终端回显和规范模式(规范模式是什么？)</span></span><br><span class="line">	tty_work.c_lflag &amp;= ~( ECHO | ICANON );  <span class="comment">// | ISIG );</span></span><br><span class="line">	tty_work.c_cc[ VMIN ]  = <span class="number">1</span>;</span><br><span class="line">	tty_work.c_cc[ VTIME ] = <span class="number">0</span>;</span><br><span class="line">	<span class="comment">//设置终端的相关参数</span></span><br><span class="line">	tcsetattr( STDIN_FILENO, TCSAFLUSH, &amp;tty_work );	</span><br><span class="line">	<span class="built_in">printf</span>( <span class="string">"\e[H\e[J"</span> );</span><br><span class="line"></span><br><span class="line">	<span class="comment">// display the legend</span></span><br><span class="line">	<span class="keyword">int</span>	i, j, k;</span><br><span class="line">	k = (<span class="number">77</span> - <span class="built_in">strlen</span>( progname ))/<span class="number">2</span>;</span><br><span class="line">	<span class="comment">//在1行k列位置打印FILEVIEW</span></span><br><span class="line">	<span class="built_in">printf</span>( <span class="string">"\e[%d;%dH %s "</span>, <span class="number">1</span>, k, progname );</span><br><span class="line">	k = (<span class="number">77</span> - <span class="built_in">strlen</span>( filename ))/<span class="number">2</span>;</span><br><span class="line">	<span class="comment">//打印/dev/dram</span></span><br><span class="line">	<span class="built_in">printf</span>( <span class="string">"\e[%d;%dH\'%s\'"</span>, <span class="number">3</span>, k, filename );</span><br><span class="line">	<span class="keyword">char</span>	infomsg[ <span class="number">80</span> ];</span><br><span class="line">	<span class="built_in">sprintf</span>( infomsg, <span class="string">"filesize: %llu (=0x%013llX)"</span>, filesize, filesize );</span><br><span class="line">	k = (<span class="number">78</span> - <span class="built_in">strlen</span>( infomsg ));</span><br><span class="line">	<span class="built_in">printf</span>( <span class="string">"\e[%d;%dH%s"</span>, <span class="number">24</span>, k, infomsg );</span><br><span class="line">	fflush( <span class="built_in">stdout</span> );</span><br><span class="line"></span><br><span class="line">	<span class="comment">// main loop to navigate the file</span></span><br><span class="line">	<span class="keyword">long</span> <span class="keyword">long</span>	pageincr = incmin;</span><br><span class="line">	<span class="keyword">long</span> <span class="keyword">long</span>	lineincr = <span class="number">16L</span>L;</span><br><span class="line">	<span class="keyword">long</span> <span class="keyword">long</span>	position = <span class="number">0L</span>L;</span><br><span class="line">	<span class="keyword">long</span> <span class="keyword">long</span>	location = <span class="number">0L</span>L;</span><br><span class="line">	<span class="keyword">int</span>		format = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">int</span>		done = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span> ( !done )&#123;</span><br><span class="line">		<span class="comment">// erase prior buffer contents</span></span><br><span class="line">		<span class="comment">//清除缓冲区内容，此缓冲区用来临时储存物理内存数据</span></span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; BUFSIZE; j++) buffer[ j ] = ~<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// restore 'pageincr' to prescribed bounds</span></span><br><span class="line">		<span class="keyword">if</span> ( pageincr == <span class="number">0L</span>L ) pageincr = incmax;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> ( pageincr &lt; incmin ) pageincr = incmin;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> ( pageincr &gt; incmax ) pageincr = incmax;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// get current location of file-pointer position</span></span><br><span class="line">		<span class="comment">//将读写位置设置为0，并获取当前读写指针的位置</span></span><br><span class="line">		location = lseek64( fd, position, SEEK_SET );</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// try to fill 'buffer[]' with data from the file</span></span><br><span class="line">		<span class="keyword">char</span>	*where = buffer;</span><br><span class="line">		<span class="keyword">int</span>	to_read = BUFSIZE;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//读取物理内存数据到buffer数组中</span></span><br><span class="line">		<span class="keyword">while</span> ( to_read &gt; <span class="number">0</span> )&#123;</span><br><span class="line">			<span class="keyword">int</span>	nbytes = read( fd, where, to_read );</span><br><span class="line">			<span class="keyword">if</span> ( nbytes &lt;= <span class="number">0</span> ) <span class="keyword">break</span>; </span><br><span class="line">			to_read -= nbytes;</span><br><span class="line">			where += nbytes;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">int</span>	datalen = BUFSIZE - to_read; </span><br><span class="line"></span><br><span class="line">		<span class="comment">// display the data just read into the 'buffer[]' array</span></span><br><span class="line">		<span class="keyword">unsigned</span> <span class="keyword">char</span>		*bp;</span><br><span class="line">		<span class="keyword">unsigned</span> <span class="keyword">short</span>		*wp;</span><br><span class="line">		<span class="keyword">unsigned</span> <span class="keyword">int</span>		*dp;</span><br><span class="line">		<span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span>	*qp;</span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; BUFHIGH; i++)&#123;</span><br><span class="line">			<span class="keyword">int</span>	linelen;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// draw the line-location (13-digit hexadecimal)</span></span><br><span class="line">			<span class="comment">//第一列打印地址到outline</span></span><br><span class="line">			linelen = <span class="built_in">sprintf</span>( outline, <span class="string">"%013llX "</span>, location );</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// draw the line in the selected hexadecimal format</span></span><br><span class="line">			<span class="keyword">switch</span> ( format )&#123;</span><br><span class="line">				<span class="comment">//以字节为单位读取buffer，然后用大写16进制输出到outline。</span></span><br><span class="line">				<span class="keyword">case</span> <span class="number">1</span>:	<span class="comment">// 'byte' format</span></span><br><span class="line">				bp = (<span class="keyword">unsigned</span> <span class="keyword">char</span>*)&amp;buffer[ i*BUFWIDE ];</span><br><span class="line">				<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; BUFWIDE; j++)</span><br><span class="line">					linelen += <span class="built_in">sprintf</span>( outline+linelen, </span><br><span class="line">						<span class="string">"%02X "</span>, bp[j] );</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">				<span class="keyword">case</span> <span class="number">2</span>:	<span class="comment">// 'word' format</span></span><br><span class="line">				wp = (<span class="keyword">unsigned</span> <span class="keyword">short</span>*)&amp;buffer[ i*BUFWIDE ];</span><br><span class="line">				<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; BUFWIDE/<span class="number">2</span>; j++)</span><br><span class="line">					linelen += <span class="built_in">sprintf</span>( outline+linelen,</span><br><span class="line">						<span class="string">" %04X "</span>, wp[j] );</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">				<span class="keyword">case</span> <span class="number">4</span>:	<span class="comment">// 'dword' format</span></span><br><span class="line">				dp = (<span class="keyword">unsigned</span> <span class="keyword">int</span>*)&amp;buffer[ i*BUFWIDE ];</span><br><span class="line">				<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; BUFWIDE/<span class="number">4</span>; j++)</span><br><span class="line">					linelen += <span class="built_in">sprintf</span>( outline+linelen,</span><br><span class="line">						<span class="string">"  %08X  "</span>, dp[j] );</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">				<span class="keyword">case</span> <span class="number">8</span>:	<span class="comment">// 'qword' format</span></span><br><span class="line">				qp = (<span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span>*)&amp;buffer[ i*BUFWIDE ];</span><br><span class="line">				<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; BUFWIDE/<span class="number">8</span>; j++)</span><br><span class="line">					linelen += <span class="built_in">sprintf</span>( outline+linelen,</span><br><span class="line">						<span class="string">"    %016llX    "</span>, qp[j] );</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">				<span class="keyword">case</span> <span class="number">16</span>: <span class="comment">// 'octaword'</span></span><br><span class="line">				qp = (<span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span>*)&amp;buffer[ i*BUFWIDE ];</span><br><span class="line">				linelen += <span class="built_in">sprintf</span>( outline+linelen, <span class="string">"     "</span> );</span><br><span class="line">				linelen += <span class="built_in">sprintf</span>( outline+linelen, </span><br><span class="line">					<span class="string">"   %016llX%016llX   "</span>, qp[<span class="number">1</span>], qp[<span class="number">0</span>] );</span><br><span class="line">				linelen += <span class="built_in">sprintf</span>( outline+linelen, <span class="string">"     "</span> ); </span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// draw the line in ascii format</span></span><br><span class="line">			<span class="comment">//以ascii格式输出数据到outline</span></span><br><span class="line">			<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; BUFWIDE; j++)&#123;</span><br><span class="line">				<span class="keyword">char</span>	ch = buffer[ i*BUFWIDE + j ];</span><br><span class="line">				<span class="keyword">if</span> (( ch &lt; <span class="number">0x20</span> )||( ch &gt; <span class="number">0x7E</span> )) ch = <span class="string">'.'</span>;</span><br><span class="line">				linelen += <span class="built_in">sprintf</span>( outline+linelen, <span class="string">"%c"</span>, ch);</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// transfer this output-line to the screen </span></span><br><span class="line">			<span class="comment">//打印outline</span></span><br><span class="line">			<span class="built_in">printf</span>( <span class="string">"\e[%d;%dH%s"</span>, ROW+i, COL, outline );</span><br><span class="line"></span><br><span class="line">			<span class="comment">// advance 'location' for the next output-line</span></span><br><span class="line">			location += BUFWIDE;</span><br><span class="line">		&#125; 	</span><br><span class="line">		<span class="built_in">printf</span>( <span class="string">"\e[%d;%dH"</span>, <span class="number">23</span>, COL );</span><br><span class="line">		fflush( <span class="built_in">stdout</span> );	</span><br><span class="line">	</span><br><span class="line">		<span class="comment">// await keypress 	</span></span><br><span class="line">		<span class="keyword">long</span> <span class="keyword">long</span>	inch = <span class="number">0L</span>L;</span><br><span class="line">		read( STDIN_FILENO, &amp;inch, <span class="keyword">sizeof</span>( inch ) );</span><br><span class="line">		<span class="built_in">printf</span>( <span class="string">"\e[%d;%dH%60s"</span>, <span class="number">23</span>, COL, <span class="string">" "</span> );	</span><br><span class="line"></span><br><span class="line">		<span class="comment">// interpret navigation or formatting command</span></span><br><span class="line">		<span class="comment">//读取输入的字符</span></span><br><span class="line">		inch &amp;= <span class="number">0x00FFFFFF</span>LL;</span><br><span class="line">		<span class="keyword">switch</span> ( inch )&#123;</span><br><span class="line">			<span class="comment">// move to the file's beginning/ending</span></span><br><span class="line">			<span class="comment">//移到文件首</span></span><br><span class="line">			<span class="keyword">case</span> <span class="string">'H'</span>: <span class="keyword">case</span> <span class="string">'h'</span>:</span><br><span class="line">			<span class="keyword">case</span> KB_HOME:	position = posmin; <span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span> <span class="string">'E'</span>: <span class="keyword">case</span> <span class="string">'e'</span>:</span><br><span class="line">			<span class="keyword">case</span> KB_END:	position = posmax; <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// move forward/backward by one line</span></span><br><span class="line">			<span class="keyword">case</span> KB_LNDN:	position += BUFWIDE; <span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span> KB_LNUP:	position -= BUFWIDE; <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// move forward/packward by one page</span></span><br><span class="line">			<span class="keyword">case</span> KB_PGDN:	position += pageincr; <span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span> KB_PGUP:	position -= pageincr; <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// increase/decrease the page-size increment</span></span><br><span class="line">			<span class="keyword">case</span> KB_RGHT:	pageincr &gt;&gt;= <span class="number">4</span>; <span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span> KB_LEFT:	pageincr &lt;&lt;= <span class="number">4</span>; <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// reset the hexadecimal output-format</span></span><br><span class="line">			<span class="keyword">case</span> <span class="string">'B'</span>: <span class="keyword">case</span> <span class="string">'b'</span>:	format = <span class="number">1</span>; <span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span> <span class="string">'W'</span>: <span class="keyword">case</span> <span class="string">'w'</span>:	format = <span class="number">2</span>; <span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span> <span class="string">'D'</span>: <span class="keyword">case</span> <span class="string">'d'</span>:	format = <span class="number">4</span>; <span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span> <span class="string">'Q'</span>: <span class="keyword">case</span> <span class="string">'q'</span>:	format = <span class="number">8</span>; <span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span> <span class="string">'O'</span>: <span class="keyword">case</span> <span class="string">'o'</span>:	format = <span class="number">16</span>; <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// seek to a user-specified file-position</span></span><br><span class="line">			<span class="keyword">case</span> KB_SEEK:</span><br><span class="line">			<span class="built_in">printf</span>( <span class="string">"\e[%d;%dHAddress: "</span>, <span class="number">23</span>, COL );</span><br><span class="line">			fflush( <span class="built_in">stdout</span> );</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">char</span>	inbuf[ <span class="number">16</span> ] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">				<span class="comment">//tcsetattr( STDIN_FILENO, TCSANOW, &amp;tty_orig );</span></span><br><span class="line">				<span class="keyword">int</span>	i = <span class="number">0</span>;</span><br><span class="line">				<span class="keyword">while</span> ( i &lt; <span class="number">15</span> )&#123;</span><br><span class="line">					<span class="keyword">long</span> <span class="keyword">long</span>	ch = <span class="number">0</span>;</span><br><span class="line">					read( STDIN_FILENO, &amp;ch, <span class="keyword">sizeof</span>( ch ) );</span><br><span class="line">					ch &amp;= <span class="number">0xFFFFFF</span>;</span><br><span class="line">					<span class="keyword">if</span> ( ch == <span class="string">'\n'</span> ) <span class="keyword">break</span>;</span><br><span class="line">					<span class="keyword">if</span> ( ch == KB_QUIT ) &#123; inbuf[<span class="number">0</span>] = <span class="number">0</span>; <span class="keyword">break</span>; &#125;</span><br><span class="line">					<span class="keyword">if</span> ( ch == KB_LEFT ) ch = KB_BACK;</span><br><span class="line">					<span class="keyword">if</span> ( ch == KB_DEL ) ch = KB_BACK;</span><br><span class="line">					<span class="keyword">if</span> (( ch == KB_BACK )&amp;&amp;( i &gt; <span class="number">0</span> ))</span><br><span class="line">						&#123; </span><br><span class="line">						inbuf[--i] = <span class="number">0</span>; </span><br><span class="line">						<span class="built_in">printf</span>( <span class="string">"\b \b"</span> ); </span><br><span class="line">						fflush( <span class="built_in">stdout</span> );</span><br><span class="line">						&#125;</span><br><span class="line">					<span class="keyword">if</span> (( ch &lt; <span class="number">0x20</span> )||( ch &gt; <span class="number">0x7E</span> )) <span class="keyword">continue</span>;</span><br><span class="line">					inbuf[ i++ ] = ch;</span><br><span class="line">					<span class="built_in">printf</span>( <span class="string">"%c"</span>, ch );</span><br><span class="line">					fflush( <span class="built_in">stdout</span> );</span><br><span class="line">				&#125;		</span><br><span class="line">				<span class="built_in">printf</span>( <span class="string">"\e[%d;%dH%70s"</span>, <span class="number">23</span>, COL, <span class="string">" "</span> );</span><br><span class="line">				fflush( <span class="built_in">stdout</span> );</span><br><span class="line">				position = strtoull( inbuf, <span class="literal">NULL</span>, <span class="number">16</span> );</span><br><span class="line">				position &amp;= ~<span class="number">0xF</span>LL;	<span class="comment">// paragraph align</span></span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">break</span>;			</span><br><span class="line"></span><br><span class="line">			<span class="comment">// program termination </span></span><br><span class="line">			<span class="keyword">case</span> KB_QUIT:	done = <span class="number">1</span>; <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">default</span>:	</span><br><span class="line">			<span class="built_in">printf</span>( <span class="string">"\e[%d;%dHHit &lt;ESC&gt; to quit"</span>, <span class="number">23</span>, <span class="number">2</span> ); </span><br><span class="line">		&#125;</span><br><span class="line">		fflush( <span class="built_in">stdout</span> );</span><br><span class="line"></span><br><span class="line">		<span class="comment">// insure that 'position' remains within bounds</span></span><br><span class="line">		<span class="keyword">if</span> ( position &lt; posmin ) position = posmin;</span><br><span class="line">		<span class="keyword">if</span> ( position &gt; posmax ) position = posmax;</span><br><span class="line">	&#125;	</span><br><span class="line"></span><br><span class="line">	<span class="comment">// restore canonical terminal behavior</span></span><br><span class="line">	<span class="comment">//复原终端的各项参数</span></span><br><span class="line">	tcsetattr( STDIN_FILENO, TCSAFLUSH, &amp;tty_orig );	</span><br><span class="line">	<span class="built_in">printf</span>( <span class="string">"\e[%d;%dH\e[0J\n"</span>, <span class="number">23</span>, <span class="number">0</span> );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Makefile文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#Makefile</span><br><span class="line">ifneq	($(KERNELRELEASE),)</span><br><span class="line">obj-m	:= dram.o </span><br><span class="line"></span><br><span class="line">else</span><br><span class="line">KDIR	:= /lib/modules/$(shell uname -r)/build</span><br><span class="line">PWD	:= $(shell pwd)</span><br><span class="line">default:</span><br><span class="line">	$(MAKE) -C $(KDIR) SUBDIRS=$(PWD) modules </span><br><span class="line">	rm -r -f .tmp_versions *.mod.c .*.cmd *.o *.symvers </span><br><span class="line"></span><br><span class="line">endif</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="虚拟地址转换为物理地址"><a href="#虚拟地址转换为物理地址" class="headerlink" title="虚拟地址转换为物理地址"></a>虚拟地址转换为物理地址</h3><p>由于虚拟内存的存在，一个二进制文件不是整个代码段加载到内存的。一个进程的内存页是否加载到物理内存，系统是有记录的。/proc/$pid/pagemap文件就记录了pid进程的虚拟地址和物理地址的映射情况。</p>
<ul>
<li>translate.c<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;assert.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;errno.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PAGEMAP_ENTRY 8</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> GET_BIT(X,Y) (X &amp; ((uint64_t)1<span class="meta-string">&lt;&lt;Y)) &gt;&gt; Y	//返回位数组中指定位的值,X:位数组，Y:位置</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> GET_PFN(X) X &amp; 0x7FFFFFFFFFFFFF		<span class="comment">//获取物理页帧号</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> __endian_bit = <span class="number">1</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> is_bigendian() ( (*(char*)&amp;__endian_bit) == 0 )</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> i, c, pid, status;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">long</span> virt_addr;</span><br><span class="line"><span class="keyword">uint64_t</span> read_val, file_offset, page_size;</span><br><span class="line"><span class="keyword">char</span> path_buf [<span class="number">0x100</span>] = &#123;&#125;;</span><br><span class="line">FILE * f;</span><br><span class="line"><span class="keyword">char</span> *end;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">read_pagemap</span><span class="params">(<span class="keyword">char</span> * path_buf, <span class="keyword">unsigned</span> <span class="keyword">long</span> virt_addr)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> ** argv)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(argc!=<span class="number">3</span>)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"Argument number is not correct!\n pagemap PID VIRTUAL_ADDRESS\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="built_in">memcmp</span>(argv[<span class="number">1</span>],<span class="string">"self"</span>,<span class="keyword">sizeof</span>(<span class="string">"self"</span>)))&#123;</span><br><span class="line">        <span class="built_in">sprintf</span>(path_buf, <span class="string">"/proc/self/pagemap"</span>);</span><br><span class="line">        pid = <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="comment">/*从字符串中解析整数</span></span><br><span class="line"><span class="comment">			argv[1]中为字符串</span></span><br><span class="line"><span class="comment">			end是一个字符指针，函数解析完long整数后，会将end指向整数之后的第一个字符。end如果为null，则不设置。</span></span><br><span class="line"><span class="comment">			10表示按照10进制解析数据，如果是0表示按照其本身进制标记来解析。</span></span><br><span class="line"><span class="comment">		*/</span></span><br><span class="line">        pid = strtol(argv[<span class="number">1</span>],&amp;end, <span class="number">10</span>);</span><br><span class="line">        <span class="keyword">if</span> (end == argv[<span class="number">1</span>] || *end != <span class="string">'\0'</span> || pid&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"PID must be a positive number or 'self'\n"</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//strtoll: Convert string to long long integer</span></span><br><span class="line">    virt_addr = strtoll(argv[<span class="number">2</span>], <span class="literal">NULL</span>, <span class="number">16</span>);</span><br><span class="line">    <span class="keyword">if</span>(pid!=<span class="number">-1</span>)</span><br><span class="line">        <span class="built_in">sprintf</span>(path_buf, <span class="string">"/proc/%u/pagemap"</span>, pid);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//获得一页内存大小</span></span><br><span class="line">    page_size = getpagesize();</span><br><span class="line">    read_pagemap(path_buf, virt_addr);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">path_buf: /proc/pid/pagemap</span></span><br><span class="line"><span class="comment">virt_addr:虚拟地址</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">read_pagemap</span><span class="params">(<span class="keyword">char</span> * path_buf, <span class="keyword">unsigned</span> <span class="keyword">long</span> virt_addr)</span></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Big endian? %d\n"</span>, is_bigendian());</span><br><span class="line">	<span class="comment">//文件访问模式 r表示读，b表示以二进制读取</span></span><br><span class="line">    f = fopen(path_buf, <span class="string">"rb"</span>);</span><br><span class="line">    <span class="keyword">if</span>(!f)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"Error! Cannot open %s\n"</span>, path_buf);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Shifting by virt-addr-offset number of bytes</span></span><br><span class="line">    <span class="comment">//and multiplying by the size of an address (the size of an entry in pagemap file)</span></span><br><span class="line">	<span class="comment">//pagemap中有一个个的页映射实体，每一个实体占8个字节。即64位，每位的作用见下一节的说明。</span></span><br><span class="line">    file_offset = virt_addr / page_size * PAGEMAP_ENTRY;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Vaddr: 0x%lx, Page_size: %lld, Entry_size: %d\n"</span>, virt_addr, page_size, PAGEMAP_ENTRY);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Reading %s at 0x%llx\n"</span>, path_buf, (<span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span>) file_offset);</span><br><span class="line">	<span class="comment">//设置文件指针f的偏移，偏移值以SEEK_SET为基准，偏移file_offset个字节。如果成功，返回0.否则返回非0值并设置error</span></span><br><span class="line">    status = fseek(f, file_offset, SEEK_SET);</span><br><span class="line">    <span class="keyword">if</span>(status)&#123;</span><br><span class="line">        perror(<span class="string">"Failed to do fseek!"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    errno = <span class="number">0</span>;</span><br><span class="line">    read_val = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> c_buf[PAGEMAP_ENTRY];</span><br><span class="line">	<span class="comment">//以字节为单位读取PAGEMAP_ENTRY到c_buf中</span></span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>; i &lt; PAGEMAP_ENTRY; i++)&#123;</span><br><span class="line">        c = getc(f);</span><br><span class="line">        <span class="keyword">if</span>(c==EOF)&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"\nReached end of the file\n"</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(is_bigendian())</span><br><span class="line">            c_buf[i] = c;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            c_buf[PAGEMAP_ENTRY - i - <span class="number">1</span>] = c;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"[%d]0x%x "</span>, i, c);</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//将c_buf的数据转存到uint64_t型变量read_val中</span></span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>; i &lt; PAGEMAP_ENTRY; i++)&#123;</span><br><span class="line">        <span class="comment">//printf("%d ",c_buf[i]);</span></span><br><span class="line">        read_val = (read_val &lt;&lt; <span class="number">8</span>) + c_buf[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Result: 0x%llx\n"</span>, (<span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span>) read_val);</span><br><span class="line">	<span class="comment">//第64位为1表示该虚拟地址已经分配了相应的物理页，然后输出了物理地址</span></span><br><span class="line">    <span class="keyword">if</span>(GET_BIT(read_val, <span class="number">63</span>)) &#123;</span><br><span class="line">        <span class="keyword">uint64_t</span> pfn = GET_PFN(read_val);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"PFN: 0x%llx (0x%llx)\n"</span>, pfn, pfn * page_size + virt_addr % page_size);</span><br><span class="line">    &#125; <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"Page not present\n"</span>);</span><br><span class="line">    <span class="keyword">if</span>(GET_BIT(read_val, <span class="number">62</span>))</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"Page swapped\n"</span>);</span><br><span class="line">    fclose(f);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="分页度量进程的代码段"><a href="#分页度量进程的代码段" class="headerlink" title="分页度量进程的代码段"></a>分页度量进程的代码段</h3><p>基于以上几个知识点，可以实现在某一时刻分页度量当时已被加载到物理内存的数据。<br>内核模块代码：<a href="https://github.com/TWS-YIFEI/Dynamic_measurement_of_process_integrity" target="_blank" rel="noopener">https://github.com/TWS-YIFEI/Dynamic_measurement_of_process_integrity</a><br>该模块实现了度量函数，度量的动作可以通过截获系统调用来触发。</p>
<h3 id="知识点记录"><a href="#知识点记录" class="headerlink" title="知识点记录"></a>知识点记录</h3><ul>
<li><p>page_to_pfn</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> page_to_pfn(page) (((page) - mem_map) + PHYS_PFN_OFFSET)</span></span><br><span class="line">page是<span class="keyword">mem_map_t</span>类型的指针。(mem_map结构体数组用来表示所有物理页)</span><br><span class="line">pfn(page frame number)，是物理页号 (还是物理地址？为什么这里要加上PHYS_PFN_OFFSET，page-mem_map不就是页号了吗)</span><br><span class="line">page-mem_map表示该页在mem_map数组中的偏移个数，就像：</span><br><span class="line">	<span class="keyword">int</span> a[<span class="number">100</span>];</span><br><span class="line">	a[<span class="number">10</span>]-a;	<span class="comment">//a[10]就好比page，a就好比mem_map，只不过mem_map是一个结构体数组</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pfn_to_page(pfn) ((mem_map + (pfn)) - PHYS_PFN_OFFSET)</span></span><br><span class="line">变换一种形式可以更容易理解:(mem_map + (pfn - PHYS_PFN_OFFSET))</span><br></pre></td></tr></table></figure>
</li>
<li><p>判断存储方式是大端还是小端</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>利用联合体</span><br><span class="line"><span class="keyword">union</span>&#123; </span><br><span class="line">	<span class="keyword">short</span>  s;	<span class="comment">//占两个字节</span></span><br><span class="line">	<span class="keyword">char</span>  c[<span class="keyword">sizeof</span>(<span class="keyword">short</span>)]; </span><br><span class="line">&#125;un;</span><br><span class="line"></span><br><span class="line">un.s = <span class="number">0x0102</span>; </span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">sizeof</span>(<span class="keyword">short</span>) == <span class="number">2</span>) &#123; </span><br><span class="line">	<span class="comment">//un.c[0]的地址为低位，如果存储的数据为高位数据，则为大端</span></span><br><span class="line">	<span class="keyword">if</span> (un.c[<span class="number">0</span>] == <span class="number">1</span> &amp;&amp; un.c[<span class="number">1</span>] == <span class="number">2</span>) </span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"big-endian\n"</span>); </span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (un.c[<span class="number">0</span>] == <span class="number">2</span> &amp;&amp; un.c[<span class="number">1</span>] == <span class="number">1</span>) </span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"little-endian\n"</span>); </span><br><span class="line">	<span class="keyword">else</span> </span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"unknown\n"</span>); </span><br><span class="line">&#125; <span class="keyword">else</span> </span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"sizeof(short) = %d\n"</span>, <span class="keyword">sizeof</span>(<span class="keyword">short</span>));</span><br><span class="line">	   </span><br><span class="line"><span class="number">2.</span>使用强制类型转换</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">is_little_endian</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">short</span> flag=<span class="number">0x4321</span>;</span><br><span class="line">	<span class="keyword">if</span> (*(<span class="keyword">unsigned</span> <span class="keyword">char</span>*)&amp;flag==<span class="number">0x21</span>)</span><br><span class="line">		<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="number">3.</span>强制类型转换</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> __endian_bit = <span class="number">1</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> is_bigendian() ((*(char*)&amp;__endian_bit)==0)</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>pagemap中每一个实体的结构</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Bits <span class="number">0</span><span class="number">-54</span>: <span class="function">page frame <span class="title">number</span><span class="params">(PFN)</span> <span class="keyword">if</span> present</span></span><br><span class="line">Bits 0-4:  swap type if swapped</span><br><span class="line">Bits <span class="number">5</span><span class="number">-54</span>: swap offset <span class="keyword">if</span> swapped</span><br><span class="line">Bits <span class="number">55</span><span class="number">-60</span>:page shift </span><br><span class="line">Bit <span class="number">61</span>:   reserved ofr future use</span><br><span class="line">Bit <span class="number">62</span>:   page swapped</span><br><span class="line">Bit <span class="number">63</span>:   page present</span><br></pre></td></tr></table></figure>
</li>
<li><p>虚拟内存&amp;物理内存<br><img src="/images_/2020_picture/20200530_virtualAddress_physicalAddress.jpg" alt=""></p>
</li>
</ul>
<h3 id="问题记录"><a href="#问题记录" class="headerlink" title="问题记录"></a>问题记录</h3><ul>
<li>在编译执行make编译dram模块时遇到下列信息，可以尝试这个方法：<a href="https://blog.csdn.net/u012343297/article/details/79141878" target="_blank" rel="noopener">https://blog.csdn.net/u012343297/article/details/79141878</a> 。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost Access_Physical_Memory]# make</span><br><span class="line">make -C /lib/modules/3.10.0-957.el7.x86_64/build SUBDIRS=/root/Access_Physical_Memory modules </span><br><span class="line">make: *** /lib/modules/3.10.0-957.el7.x86_64/build: No such file or directory.  Stop.</span><br><span class="line">make: *** [default] Error 2</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="http://blog.chinaunix.net/uid-20564848-id-72855.html?utm_source=jiancool" target="_blank" rel="noopener">对于结构体指针+、-常数的理解(page_to_pfn和pfn_to_page)</a></li>
<li><a href="http://ilinuxkernel.com/?p=1248x" target="_blank" rel="noopener">Linux用户程序如何访问物理内存</a></li>
<li><a href="https://blog.csdn.net/avrmcu1/article/details/16939063" target="_blank" rel="noopener">Linux中的虚拟地址、物理地址和内存管理方式</a></li>
<li><a href="https://blog.csdn.net/zhanglei4214/article/details/6653568" target="_blank" rel="noopener">利用mmap /dev/mem 读写Linux内存</a></li>
<li><a href="https://blog.csdn.net/demonshir/article/details/50414839" target="_blank" rel="noopener">判断内存地址是否缺页</a></li>
<li><a href="https://blog.csdn.net/sium__/article/details/49700971" target="_blank" rel="noopener">写自己的内核模块——获取一个进程的物理地址</a></li>
<li><a href="https://www.cnblogs.com/rongpmcu/p/7662749.html" target="_blank" rel="noopener">copy_from_user分析</a></li>
</ul>
<!-- 
category : ACM_Algorithm CTF C_Cpp JAVA Linux Linux_Kernel 
SQL Cryptography Life Reading Thought Summary Security Unknown Tools  
Network Qt Trusted_Computing English System_Programming Network_Programming
Python Reading_Source
　　←全角空格
![keyboard](https://img-bter)   ←图片
![keyboard](/images_/2020_picture)   ←图片
[keyboard](https://img-bter)    ←超链接

|    |   |    |
| :----: | :----:  | :----:  |
|      |  |      |
|        |      |      |
|        |       |    |

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>–&gt;<br>欢迎与我分享你的看法。<br>转载请注明出处：<a href="http://taowusheng.cn/">http://taowusheng.cn/</a></p>
-->
      
    </div>
    <footer class="article-footer">
      <a data-url="http://taowusheng.cn/2020/05/30/20200530 如何实现进程代码段的分页度量/" data-id="cl9smuymo00ox9boisjk41wrf" class="article-share-link">Share</a>
      
      
        <a href="/2020/05/30/20200530 如何实现进程代码段的分页度量/#comments" class="article-comment-link">
          <span class="post-comments-count valine-comment-count" data-xid="/2020/05/30/20200530 如何实现进程代码段的分页度量/" itemprop="commentCount"></span>
          Comments
        </a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux-Kernel/">Linux_Kernel</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/memory/">memory</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/内存管理/">内存管理</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2020/06/05/20200605 线段树笔记/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          线段树笔记
        
      </div>
    </a>
  
  
    <a href="/2020/05/23/20200523 如何编写一个简单地内核模块/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">如何编写一个简单地内核模块</div>
    </a>
  
</nav>

  
</article>



  <section id="comments" class="vcomment">

  </section>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/ACM-Algorithm/">ACM_Algorithm</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Assembly/">Assembly</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/C-Cpp/">C_Cpp</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Cryptography/">Cryptography</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/English/">English</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JAVA/">JAVA</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Life/">Life</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux-Kernel/">Linux_Kernel</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Middleware/">Middleware</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Network/">Network</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Network-Programming/">Network_Programming</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Notes/">Notes</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Qt/">Qt</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Reading/">Reading</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Reading-Source/">Reading_Source</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/SQL/">SQL</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Security/">Security</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Summary/">Summary</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/System-Programming/">System_Programming</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Thought/">Thought</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tools/">Tools</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Translation/">Translation</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Trusted-Computing/">Trusted_Computing</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Unknown/">Unknown</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/reading/">reading</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/01背包/" style="font-size: 10px;">01背包</a> <a href="/tags/2017/" style="font-size: 10px;">2017</a> <a href="/tags/2018/" style="font-size: 11.11px;">2018</a> <a href="/tags/2021/" style="font-size: 10px;">2021</a> <a href="/tags/ACM/" style="font-size: 13.33px;">ACM</a> <a href="/tags/ACM-Algorithm/" style="font-size: 10px;">ACM_Algorithm</a> <a href="/tags/Algorithm/" style="font-size: 10px;">Algorithm</a> <a href="/tags/Assembly/" style="font-size: 11.11px;">Assembly</a> <a href="/tags/C/" style="font-size: 11.11px;">C</a> <a href="/tags/C/" style="font-size: 12.22px;">C++</a> <a href="/tags/CTF/" style="font-size: 10px;">CTF</a> <a href="/tags/C-Cpp/" style="font-size: 12.22px;">C_Cpp</a> <a href="/tags/California-Dreaming/" style="font-size: 10px;">California_Dreaming</a> <a href="/tags/Cpp/" style="font-size: 14.44px;">Cpp</a> <a href="/tags/DES/" style="font-size: 10px;">DES</a> <a href="/tags/EDK/" style="font-size: 10px;">EDK</a> <a href="/tags/Effective-Cpp/" style="font-size: 10px;">Effective_Cpp</a> <a href="/tags/English/" style="font-size: 11.11px;">English</a> <a href="/tags/GMP/" style="font-size: 10px;">GMP</a> <a href="/tags/GUI/" style="font-size: 10px;">GUI</a> <a href="/tags/IO/" style="font-size: 10px;">IO</a> <a href="/tags/IO复用/" style="font-size: 10px;">IO复用</a> <a href="/tags/IO多路复用/" style="font-size: 10px;">IO多路复用</a> <a href="/tags/JAVA/" style="font-size: 16.67px;">JAVA</a> <a href="/tags/JavaScript/" style="font-size: 10px;">JavaScript</a> <a href="/tags/JsonCpp/" style="font-size: 10px;">JsonCpp</a> <a href="/tags/KGDB/" style="font-size: 10px;">KGDB</a> <a href="/tags/LeetCode/" style="font-size: 10px;">LeetCode</a> <a href="/tags/Linux/" style="font-size: 13.33px;">Linux</a> <a href="/tags/Linux-Kernel/" style="font-size: 13.33px;">Linux_Kernel</a> <a href="/tags/Middleware/" style="font-size: 10px;">Middleware</a> <a href="/tags/Network/" style="font-size: 11.11px;">Network</a> <a href="/tags/Network-Programming/" style="font-size: 13.33px;">Network_Programming</a> <a href="/tags/Python/" style="font-size: 15.56px;">Python</a> <a href="/tags/Qt/" style="font-size: 10px;">Qt</a> <a href="/tags/RSA/" style="font-size: 10px;">RSA</a> <a href="/tags/SELinux/" style="font-size: 10px;">SELinux</a> <a href="/tags/SHA/" style="font-size: 10px;">SHA</a> <a href="/tags/SQL/" style="font-size: 10px;">SQL</a> <a href="/tags/SSL/" style="font-size: 10px;">SSL</a> <a href="/tags/STL/" style="font-size: 14.44px;">STL</a> <a href="/tags/Security/" style="font-size: 10px;">Security</a> <a href="/tags/Summary/" style="font-size: 17.78px;">Summary</a> <a href="/tags/System-Programming/" style="font-size: 11.11px;">System_Programming</a> <a href="/tags/TSS/" style="font-size: 10px;">TSS</a> <a href="/tags/Thread/" style="font-size: 10px;">Thread</a> <a href="/tags/Tools/" style="font-size: 10px;">Tools</a> <a href="/tags/Translation/" style="font-size: 10px;">Translation</a> <a href="/tags/UDK/" style="font-size: 10px;">UDK</a> <a href="/tags/UDP/" style="font-size: 10px;">UDP</a> <a href="/tags/UEFI/" style="font-size: 10px;">UEFI</a> <a href="/tags/VMware/" style="font-size: 11.11px;">VMware</a> <a href="/tags/apt/" style="font-size: 10px;">apt</a> <a href="/tags/audit2allow/" style="font-size: 10px;">audit2allow</a> <a href="/tags/auth/" style="font-size: 10px;">auth</a> <a href="/tags/bellman/" style="font-size: 10px;">bellman</a> <a href="/tags/bitmap/" style="font-size: 10px;">bitmap</a> <a href="/tags/bjut/" style="font-size: 10px;">bjut</a> <a href="/tags/c/" style="font-size: 10px;">c++</a> <a href="/tags/concept/" style="font-size: 12.22px;">concept</a> <a href="/tags/cpp/" style="font-size: 15.56px;">cpp</a> <a href="/tags/cryptography/" style="font-size: 11.11px;">cryptography</a> <a href="/tags/curses/" style="font-size: 10px;">curses</a> <a href="/tags/deque/" style="font-size: 10px;">deque</a> <a href="/tags/dijkstra/" style="font-size: 10px;">dijkstra</a> <a href="/tags/dpkg/" style="font-size: 10px;">dpkg</a> <a href="/tags/echo/" style="font-size: 10px;">echo</a> <a href="/tags/emulator/" style="font-size: 10px;">emulator</a> <a href="/tags/english/" style="font-size: 12.22px;">english</a> <a href="/tags/epoll/" style="font-size: 10px;">epoll</a> <a href="/tags/floyd/" style="font-size: 10px;">floyd</a> <a href="/tags/g/" style="font-size: 10px;">g++</a> <a href="/tags/gcc/" style="font-size: 10px;">gcc</a> <a href="/tags/gdb/" style="font-size: 11.11px;">gdb</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/github/" style="font-size: 10px;">github</a> <a href="/tags/ip/" style="font-size: 11.11px;">ip</a> <a href="/tags/jdbc/" style="font-size: 10px;">jdbc</a> <a href="/tags/kernal/" style="font-size: 10px;">kernal</a> <a href="/tags/life/" style="font-size: 10px;">life</a> <a href="/tags/linus/" style="font-size: 10px;">linus</a> <a href="/tags/linux/" style="font-size: 18.89px;">linux</a> <a href="/tags/linux内核/" style="font-size: 10px;">linux内核</a> <a href="/tags/list/" style="font-size: 10px;">list</a> <a href="/tags/mail服务器/" style="font-size: 10px;">mail服务器</a> <a href="/tags/map/" style="font-size: 11.11px;">map</a> <a href="/tags/md5注入/" style="font-size: 10px;">md5注入</a> <a href="/tags/memory/" style="font-size: 10px;">memory</a> <a href="/tags/mysql/" style="font-size: 10px;">mysql</a> <a href="/tags/new/" style="font-size: 12.22px;">new</a> <a href="/tags/notes/" style="font-size: 12.22px;">notes</a> <a href="/tags/openstack/" style="font-size: 10px;">openstack</a> <a href="/tags/pam/" style="font-size: 10px;">pam</a> <a href="/tags/patch/" style="font-size: 10px;">patch</a> <a href="/tags/ping/" style="font-size: 10px;">ping</a> <a href="/tags/pip/" style="font-size: 10px;">pip</a> <a href="/tags/poll/" style="font-size: 10px;">poll</a> <a href="/tags/postfix/" style="font-size: 10px;">postfix</a> <a href="/tags/protobuf/" style="font-size: 10px;">protobuf</a> <a href="/tags/qemu/" style="font-size: 10px;">qemu</a> <a href="/tags/queue/" style="font-size: 10px;">queue</a> <a href="/tags/reading/" style="font-size: 20px;">reading</a> <a href="/tags/redis/" style="font-size: 10px;">redis</a> <a href="/tags/rodata/" style="font-size: 10px;">rodata</a> <a href="/tags/select/" style="font-size: 10px;">select</a> <a href="/tags/selinux/" style="font-size: 10px;">selinux</a> <a href="/tags/set/" style="font-size: 10px;">set</a> <a href="/tags/stack/" style="font-size: 10px;">stack</a> <a href="/tags/thought/" style="font-size: 12.22px;">thought</a> <a href="/tags/tinythhpd/" style="font-size: 10px;">tinythhpd</a> <a href="/tags/tinyxml/" style="font-size: 10px;">tinyxml</a> <a href="/tags/tools/" style="font-size: 12.22px;">tools</a> <a href="/tags/tpm/" style="font-size: 10px;">tpm</a> <a href="/tags/traits/" style="font-size: 10px;">traits</a> <a href="/tags/trousers/" style="font-size: 10px;">trousers</a> <a href="/tags/trusted-computing/" style="font-size: 10px;">trusted_computing</a> <a href="/tags/unix编程实践/" style="font-size: 10px;">unix编程实践</a> <a href="/tags/valgrind/" style="font-size: 10px;">valgrind</a> <a href="/tags/vector/" style="font-size: 10px;">vector</a> <a href="/tags/vim/" style="font-size: 10px;">vim</a> <a href="/tags/vs2013/" style="font-size: 10px;">vs2013</a> <a href="/tags/web/" style="font-size: 10px;">web</a> <a href="/tags/web服务器/" style="font-size: 10px;">web服务器</a> <a href="/tags/win10/" style="font-size: 10px;">win10</a> <a href="/tags/xml/" style="font-size: 10px;">xml</a> <a href="/tags/yum/" style="font-size: 10px;">yum</a> <a href="/tags/世界上最遥远的距离/" style="font-size: 10px;">世界上最遥远的距离</a> <a href="/tags/个人成长/" style="font-size: 11.11px;">个人成长</a> <a href="/tags/书单/" style="font-size: 12.22px;">书单</a> <a href="/tags/书摘/" style="font-size: 10px;">书摘</a> <a href="/tags/事件驱动/" style="font-size: 10px;">事件驱动</a> <a href="/tags/产品/" style="font-size: 10px;">产品</a> <a href="/tags/代码段/" style="font-size: 10px;">代码段</a> <a href="/tags/优先级/" style="font-size: 10px;">优先级</a> <a href="/tags/位向量/" style="font-size: 10px;">位向量</a> <a href="/tags/位图/" style="font-size: 10px;">位图</a> <a href="/tags/信号/" style="font-size: 10px;">信号</a> <a href="/tags/公钥/" style="font-size: 10px;">公钥</a> <a href="/tags/公钥密码/" style="font-size: 10px;">公钥密码</a> <a href="/tags/内存池/" style="font-size: 10px;">内存池</a> <a href="/tags/内存泄漏/" style="font-size: 10px;">内存泄漏</a> <a href="/tags/内存管理/" style="font-size: 10px;">内存管理</a> <a href="/tags/内核/" style="font-size: 10px;">内核</a> <a href="/tags/内核模块/" style="font-size: 10px;">内核模块</a> <a href="/tags/刘未鹏/" style="font-size: 11.11px;">刘未鹏</a> <a href="/tags/动态规划/" style="font-size: 10px;">动态规划</a> <a href="/tags/区间和/" style="font-size: 10px;">区间和</a> <a href="/tags/单例模式/" style="font-size: 10px;">单例模式</a> <a href="/tags/参考策略/" style="font-size: 10px;">参考策略</a> <a href="/tags/可信计算/" style="font-size: 11.11px;">可信计算</a> <a href="/tags/后台开发/" style="font-size: 10px;">后台开发</a> <a href="/tags/回显服务器/" style="font-size: 10px;">回显服务器</a> <a href="/tags/多线程/" style="font-size: 10px;">多线程</a> <a href="/tags/学习之路/" style="font-size: 10px;">学习之路</a> <a href="/tags/学习计划/" style="font-size: 10px;">学习计划</a> <a href="/tags/容器/" style="font-size: 10px;">容器</a> <a href="/tags/密码体制/" style="font-size: 10px;">密码体制</a> <a href="/tags/密码学/" style="font-size: 12.22px;">密码学</a> <a href="/tags/富爸爸穷爸爸/" style="font-size: 10px;">富爸爸穷爸爸</a> <a href="/tags/对称密码/" style="font-size: 10px;">对称密码</a> <a href="/tags/川藏线/" style="font-size: 10px;">川藏线</a> <a href="/tags/年终总结/" style="font-size: 13.33px;">年终总结</a> <a href="/tags/广告/" style="font-size: 10px;">广告</a> <a href="/tags/异常处理/" style="font-size: 10px;">异常处理</a> <a href="/tags/异步/" style="font-size: 10px;">异步</a> <a href="/tags/心智/" style="font-size: 10px;">心智</a> <a href="/tags/心理学/" style="font-size: 10px;">心理学</a> <a href="/tags/思维导图/" style="font-size: 10px;">思维导图</a> <a href="/tags/思考/" style="font-size: 12.22px;">思考</a> <a href="/tags/总结/" style="font-size: 15.56px;">总结</a> <a href="/tags/我是一只IT小小鸟/" style="font-size: 10px;">我是一只IT小小鸟</a> <a href="/tags/投资/" style="font-size: 10px;">投资</a> <a href="/tags/投资理财/" style="font-size: 11.11px;">投资理财</a> <a href="/tags/指数基金/" style="font-size: 10px;">指数基金</a> <a href="/tags/挑战程序设计竞赛/" style="font-size: 11.11px;">挑战程序设计竞赛</a> <a href="/tags/提问的智慧/" style="font-size: 10px;">提问的智慧</a> <a href="/tags/搜索/" style="font-size: 10px;">搜索</a> <a href="/tags/摄影/" style="font-size: 11.11px;">摄影</a> <a href="/tags/操作系统/" style="font-size: 10px;">操作系统</a> <a href="/tags/数据库/" style="font-size: 12.22px;">数据库</a> <a href="/tags/文本查询/" style="font-size: 10px;">文本查询</a> <a href="/tags/暗时间/" style="font-size: 10px;">暗时间</a> <a href="/tags/最短路径算法/" style="font-size: 10px;">最短路径算法</a> <a href="/tags/析构函数/" style="font-size: 10px;">析构函数</a> <a href="/tags/查理芒格/" style="font-size: 10px;">查理芒格</a> <a href="/tags/毕业旅行/" style="font-size: 10px;">毕业旅行</a> <a href="/tags/汇编/" style="font-size: 10px;">汇编</a> <a href="/tags/汇编语言/" style="font-size: 10px;">汇编语言</a> <a href="/tags/源码阅读/" style="font-size: 12.22px;">源码阅读</a> <a href="/tags/爬虫/" style="font-size: 10px;">爬虫</a> <a href="/tags/理财/" style="font-size: 10px;">理财</a> <a href="/tags/生活随笔/" style="font-size: 10px;">生活随笔</a> <a href="/tags/知识点/" style="font-size: 10px;">知识点</a> <a href="/tags/碎碎念/" style="font-size: 10px;">碎碎念</a> <a href="/tags/私钥/" style="font-size: 10px;">私钥</a> <a href="/tags/秋招/" style="font-size: 10px;">秋招</a> <a href="/tags/程序员/" style="font-size: 11.11px;">程序员</a> <a href="/tags/立flag/" style="font-size: 10px;">立flag</a> <a href="/tags/笔记/" style="font-size: 10px;">笔记</a> <a href="/tags/笔试/" style="font-size: 10px;">笔试</a> <a href="/tags/算法/" style="font-size: 11.11px;">算法</a> <a href="/tags/算法题/" style="font-size: 10px;">算法题</a> <a href="/tags/系统编程/" style="font-size: 11.11px;">系统编程</a> <a href="/tags/红黑树/" style="font-size: 10px;">红黑树</a> <a href="/tags/线段树/" style="font-size: 10px;">线段树</a> <a href="/tags/线程池/" style="font-size: 10px;">线程池</a> <a href="/tags/经历/" style="font-size: 10px;">经历</a> <a href="/tags/网络编程/" style="font-size: 12.22px;">网络编程</a> <a href="/tags/翻译/" style="font-size: 10px;">翻译</a> <a href="/tags/考研/" style="font-size: 10px;">考研</a> <a href="/tags/虚函数/" style="font-size: 10px;">虚函数</a> <a href="/tags/虚基类/" style="font-size: 10px;">虚基类</a> <a href="/tags/计划/" style="font-size: 10px;">计划</a> <a href="/tags/计时器/" style="font-size: 10px;">计时器</a> <a href="/tags/计算机/" style="font-size: 10px;">计算机</a> <a href="/tags/计算机技术/" style="font-size: 10px;">计算机技术</a> <a href="/tags/计算机网络/" style="font-size: 10px;">计算机网络</a> <a href="/tags/设计模式/" style="font-size: 10px;">设计模式</a> <a href="/tags/读书/" style="font-size: 10px;">读书</a> <a href="/tags/读书笔记/" style="font-size: 13.33px;">读书笔记</a> <a href="/tags/调试/" style="font-size: 10px;">调试</a> <a href="/tags/进程/" style="font-size: 10px;">进程</a> <a href="/tags/重定向/" style="font-size: 10px;">重定向</a> <a href="/tags/阅读/" style="font-size: 10px;">阅读</a> <a href="/tags/阻塞/" style="font-size: 10px;">阻塞</a> <a href="/tags/面向对象/" style="font-size: 11.11px;">面向对象</a> <a href="/tags/面向过程/" style="font-size: 10px;">面向过程</a> <a href="/tags/预处理/" style="font-size: 10px;">预处理</a> <a href="/tags/骑行/" style="font-size: 10px;">骑行</a> <a href="/tags/黑客与画家/" style="font-size: 10px;">黑客与画家</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2029/11/">November 2029</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/10/">October 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2029/11/11/20291111 坚持阅读/">坚持阅读</a>
          </li>
        
          <li>
            <a href="/2022/10/27/20221027 北京香山公园一日游/">北京香山公园一日游</a>
          </li>
        
          <li>
            <a href="/2021/12/31/20211231 2021年终总结/">2021年终总结</a>
          </li>
        
          <li>
            <a href="/2021/10/11/20211011 我的毕业旅行/">我的毕业旅行</a>
          </li>
        
          <li>
            <a href="/2020/12/31/20201231 2020年终总结/">2020年终总结</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">visiters</h3>
    <div class="widget">
      <script type="text/javascript" src="//rf.revolvermaps.com/0/0/8.js?i=534a4dn9fi8&amp;m=0c&amp;c=ff0000&amp;cr1=ffffff&amp;f=ubuntu&amp;l=0&amp;cw=ffffff&amp;cb=000000" async="async"></script>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016-2021 Tao WuSheng<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/links" class="mobile-nav-link">Links</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>




  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
<script>
    var GUEST_INFO = ['nick','mail','link'];
    var guest_info = 'nick,mail,link'.split(',').filter(function(item){
        return GUEST_INFO.indexOf(item) > -1
    });
    var notify = 'true' == true;
    var verify = 'true' == true;
    new Valine({
        el: '.vcomment',
        notify: notify,
        verify: verify,
        appId: "IwNQge9YG0FIzuQKmRVrBgCL-gzGzoHsz",
        appKey: "IP8hmPLhobMvvjpkfm1OKzuv",
        placeholder: "Please leave your footprints...",
        pageSize:'10',
        avatar:'mm',
        lang:'zh-cn'
    });
</script>

  </div>
</body>
</html>